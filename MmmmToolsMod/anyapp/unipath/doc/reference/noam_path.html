<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="index,nofollow">


<title>AlternativePathModule - PythonInfo Wiki</title>

<script type="text/javascript">
<!--// common functions

// We keep here the state of the search box
searchIsDisabled = false;

function searchChange(e) {
    // Update search buttons status according to search box content.
    // Ignore empty or whitespace search term.
    var value = e.value.replace(/\s+/, '');
    if (value == '' || searchIsDisabled) { 
        searchSetDisabled(true);
    } else {
        searchSetDisabled(false);
    }
}

function searchSetDisabled(flag) {
    // Enable or disable search
    document.getElementById('fullsearch').disabled = flag;
    document.getElementById('titlesearch').disabled = flag;
}

function searchFocus(e) {
    // Update search input content on focus
    if (e.value == 'Search') {
        e.value = '';
        e.style.color = 'black';
        searchIsDisabled = false;
    }
}

function searchBlur(e) {
    // Update search input content on blur
    if (e.value == '') {
        e.value = 'Search';
        e.style.color = 'gray';
        searchIsDisabled = true;
    }
}

function actionsMenuInit(title) {
    // Initiliaze action menu
    for (i = 0; i < document.forms.length; i++) {
        var form = document.forms[i];
        if (form.className == 'actionsmenu') {
            // Check if this form needs update
            var div = form.getElementsByTagName('div')[0];
            var label = div.getElementsByTagName('label')[0];
            if (label) {
                // This is the first time: remove label and do buton.
                div.removeChild(label);
                var dobutton = div.getElementsByTagName('input')[0];
                div.removeChild(dobutton);
                // and add menu title
                var select = div.getElementsByTagName('select')[0];
                var item = document.createElement('option');
                item.appendChild(document.createTextNode(title));
                item.value = 'show';
                select.insertBefore(item, select.options[0]);
                select.selectedIndex = 0;
            }
        }
    }
}
//-->
</script>

<!--style-start -->
  <style type="text/css" media="screen">@import "http://www.python.org/styles/styles.css";</style>
  <link rel="stylesheet" type="text/css" media="sc&#82;een" href="http://www.python.org/styles/netscape4.css" />
  <link rel="stylesheet" type="text/css" media="print" href="http://www.python.org/styles/print.css" />
  <link rel="alternate stylesheet" type="text/css" media="screen" href="http://www.python.org/styles/largestyles.css" title="large text" />
  

<link rel="Start" href="/moin/FrontPage">
<link rel="Alternate" title="Wiki Markup" href="/moin/AlternativePathModule?action=raw">
<link rel="Alternate" media="print" title="Print View" href="/moin/AlternativePathModule?action=print">
<link rel="Search" href="/moin/FindPage">
<link rel="Index" href="/moin/TitleIndex">
<link rel="Glossary" href="/moin/WordIndex">
<link rel="Help" href="/moin/HelpOnFormatting">
</head>
<body  lang="en" dir="ltr">

  <!-- Logo -->
  <h1 id="logoheader">
    <a href="http://www.python.org" id="logolink" accesskey="1"><img id="logo" src="http://www.python.org/images/python-logo.gif" alt="homepage" border="0" /></a>
  </h1>
  <!-- Skip to Navigation -->
  <div class="skiptonav"><a href="#navigation" accesskey="2"><img src="http://www.python.org/images/trans.gif" id="skiptonav" alt="skip to navigation" border="0" /></a></div>
  <div class="skiptonav"><a href="#content" accesskey="3"><img src="http://www.python.org/images/trans.gif" id="skiptocontent" alt="skip to content" border="0" /></a></div>
  <!-- Utility Menu -->
  <div id="utility-menu"></div>
  <!-- Search Box -->
  <div id="searchbox">
    <form action="http://google.com" id="searchform" name="searchform">
      <div id="search">
        <input type="text" class="input-text" name="text" />
        <input type="button" value="search" class="input-button" name="search" />
      </div>
    </form>
  </div>

  <div id="content-body">
    <div id="body-main">

    <h1 class="pageheading">
<h1 id="title"><a title="Click to do a full-text search for this title" href="/moin/AlternativePathModule?action=fullsearch&amp;value=linkto%3A%22AlternativePathModule%22&amp;context=180">AlternativePathModule</a></h1>
</h1>
<ul id="iconbar">
<li><a title="Edit" href="/moin/AlternativePathModule?action=edit"><img src="/wiki/beta/img/moin-edit.png" alt="Edit" height="12" width="12"></a></li>
<li><a title="View" href="/moin/AlternativePathModule"><img src="/wiki/beta/img/moin-show.png" alt="View" height="13" width="12"></a></li>
<li><a title="Diffs" href="/moin/AlternativePathModule?action=diff"><img src="/wiki/beta/img/moin-diff.png" alt="Diffs" height="11" width="15"></a></li>
<li><a title="Info" href="/moin/AlternativePathModule?action=info"><img src="/wiki/beta/img/moin-info.png" alt="Info" height="11" width="12"></a></li>
<li><a title="Subscribe" href="/moin/AlternativePathModule?action=subscribe"><img src="/wiki/beta/img/moin-subscribe.png" alt="Subscribe" height="10" width="14"></a></li>
<li><a title="Raw" href="/moin/AlternativePathModule?action=raw"><img src="/wiki/beta/img/moin-raw.png" alt="Raw" height="13" width="12"></a></li>
<li><a title="Print" href="/moin/AlternativePathModule?action=print"><img src="/wiki/beta/img/moin-print.png" alt="Print" height="14" width="16"></a></li>
</ul>


<form id="searchform" method="get" action="">
<div>
<input type="hidden" name="action" value="fullsearch">
<input type="hidden" name="context" value="180">
<label for="searchinput">Search:</label>
<input id="searchinput" type="text" name="value" value="" size="20"
    onfocus="searchFocus(this)" onblur="searchBlur(this)"
    onkeyup="searchChange(this)" onchange="searchChange(this)" alt="Search">
<input id="titlesearch" name="titlesearch" type="submit"
    value="Titles" alt="Search Titles">
<input id="fullsearch" name="fullsearch" type="submit"
    value="Text" alt="Search Full Text">
</div>
</form>
<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);
//-->
</script>


<div lang="en" id="content" dir="ltr">
<a id="top"></a>
<div lang="en" class="codearea" dir="ltr">
<script type="text/JavaScript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c))
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        s.className = 'LineNumber'
        s.appendChild(document.createTextNode(nformat(n,4,' ')));
        n += nstep;
        if (l.childNodes.length)
          l.insertBefore(s, l.firstChild)
        else
          l.appendChild(s)
      }
      l = l.nextSibling;
    }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c))
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onClick="return togglenumber(\'CA-af638fa3e0da2314c4be5a6d434430c8f84c372f_000\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre lang="en" id="CA-af638fa3e0da2314c4be5a6d434430c8f84c372f_000" dir="ltr">
<span class="line"><span class="LineNumber">   1 </span><span class="Comment"># -*- coding: iso-8859-1 -*-</span></span>
<span class="line"><span class="LineNumber">   2 </span><span class="Comment"></span><span class="String">""" path.py - An object representing a path to a file or a directory.</span></span>
<span class="line"><span class="LineNumber">   3 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">   4 </span><span class="String">Based on the path module by Jason Orendorff</span></span>
<span class="line"><span class="LineNumber">   5 </span><span class="String">(http://www.jorendorff.com/articles/python/path)</span></span>
<span class="line"><span class="LineNumber">   6 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">   7 </span><span class="String">Written by Noam Raphael to show the idea of using a tuple instead of</span></span>
<span class="line"><span class="LineNumber">   8 </span><span class="String">a string, and to reduce the number of methods.</span></span>
<span class="line"><span class="LineNumber">   9 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">  10 </span><span class="String">Currently only implements posix and nt paths - more can be added.</span></span>
<span class="line"><span class="LineNumber">  11 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">  12 </span><span class="String">"""</span></span>
<span class="line"><span class="LineNumber">  13 </span></span>
<span class="line"><span class="LineNumber">  14 </span><span class="ResWord">import</span> <span class="ID">os</span></span>
<span class="line"><span class="LineNumber">  15 </span><span class="ResWord">import</span> <span class="ID">stat</span></span>
<span class="line"><span class="LineNumber">  16 </span><span class="ResWord">import</span> <span class="ID">itertools</span></span>
<span class="line"><span class="LineNumber">  17 </span><span class="ResWord">import</span> <span class="ID">fnmatch</span></span>
<span class="line"><span class="LineNumber">  18 </span><span class="ResWord">import</span> <span class="ID">re</span></span>
<span class="line"><span class="LineNumber">  19 </span><span class="ResWord">import</span> <span class="ID">string</span></span>
<span class="line"><span class="LineNumber">  20 </span></span>
<span class="line"><span class="LineNumber">  21 </span><span class="ResWord">class</span> <span class="ID">StatWrapper</span><span class="Operator">(</span><span class="ID">object</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  22 </span>    <span class="String">""" A wrapper around stat_result objects which gives additional properties.</span></span>
<span class="line"><span class="LineNumber">  23 </span><span class="String">    </span></span>
<span class="line"><span class="LineNumber">  24 </span><span class="String">    This object is a wrapper around a stat_result object. It allows access</span></span>
<span class="line"><span class="LineNumber">  25 </span><span class="String">    to all the original object's attributes, and adds a few convinient</span></span>
<span class="line"><span class="LineNumber">  26 </span><span class="String">    properties, by using the stat module.</span></span>
<span class="line"><span class="LineNumber">  27 </span><span class="String">    </span></span>
<span class="line"><span class="LineNumber">  28 </span><span class="String">    This object should have been a subclass posix.stat_result - it simply</span></span>
<span class="line"><span class="LineNumber">  29 </span><span class="String">    isn't possible currently. This functionality may also be integrated into</span></span>
<span class="line"><span class="LineNumber">  30 </span><span class="String">    the original type.</span></span>
<span class="line"><span class="LineNumber">  31 </span><span class="String">    """</span></span>
<span class="line"><span class="LineNumber">  32 </span></span>
<span class="line"><span class="LineNumber">  33 </span>    <span class="ID">__slots__</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="String">'_stat'</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">  34 </span></span>
<span class="line"><span class="LineNumber">  35 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">stat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  36 </span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">_stat</span> <span class="Operator">=</span> <span class="ID">stat</span></span>
<span class="line"><span class="LineNumber">  37 </span></span>
<span class="line"><span class="LineNumber">  38 </span>    <span class="ResWord">def</span> <span class="ID">__getattribute__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">attr</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">default</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  39 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  40 </span>            <span class="ResWord">return</span> <span class="ID">object</span><span class="Operator">.</span><span class="ID">__getattribute__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">attr</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">default</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  41 </span>        <span class="ResWord">except</span> <span class="ID">AttributeError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  42 </span>            <span class="ResWord">return</span> <span class="ID">getattr</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">_stat</span><span class="Operator">,</span> <span class="ID">attr</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">default</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  43 </span></span>
<span class="line"><span class="LineNumber">  44 </span>    <span class="Comment"># Mode properties</span></span>
<span class="line"><span class="LineNumber">  45 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">  46 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  47 </span>    <span class="ResWord">def</span> <span class="ID">isdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  48 </span>        <span class="ResWord">return</span> <span class="ID">stat</span><span class="Operator">.</span><span class="ID">S_ISDIR</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">st_mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  49 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  50 </span>    <span class="ResWord">def</span> <span class="ID">isfile</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  51 </span>        <span class="ResWord">return</span> <span class="ID">stat</span><span class="Operator">.</span><span class="ID">S_ISREG</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">st_mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  52 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  53 </span>    <span class="ResWord">def</span> <span class="ID">islink</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  54 </span>        <span class="ResWord">return</span> <span class="ID">stat</span><span class="Operator">.</span><span class="ID">S_ISLNK</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">st_mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">  55 </span></span>
<span class="line"><span class="LineNumber">  56 </span>    <span class="Comment"># Easier names properties</span></span>
<span class="line"><span class="LineNumber">  57 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">  58 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  59 </span>    <span class="ResWord">def</span> <span class="ID">size</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  60 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">st_size</span></span>
<span class="line"><span class="LineNumber">  61 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  62 </span>    <span class="ResWord">def</span> <span class="ID">mtime</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  63 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">st_mtime</span></span>
<span class="line"><span class="LineNumber">  64 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  65 </span>    <span class="ResWord">def</span> <span class="ID">atime</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  66 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">st_atime</span></span>
<span class="line"><span class="LineNumber">  67 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">  68 </span>    <span class="ResWord">def</span> <span class="ID">ctime</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  69 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">st_ctime</span></span>
<span class="line"><span class="LineNumber">  70 </span></span>
<span class="line"><span class="LineNumber">  71 </span></span>
<span class="line"><span class="LineNumber">  72 </span><span class="ResWord">class</span> <span class="ID">BasePath</span><span class="Operator">(</span><span class="ID">tuple</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  73 </span>    <span class="String">""" The base, abstract, path type.</span></span>
<span class="line"><span class="LineNumber">  74 </span><span class="String">    </span></span>
<span class="line"><span class="LineNumber">  75 </span><span class="String">    The OS-specific path types inherit from it.</span></span>
<span class="line"><span class="LineNumber">  76 </span><span class="String">    """</span></span>
<span class="line"><span class="LineNumber">  77 </span></span>
<span class="line"><span class="LineNumber">  78 </span>    <span class="Comment"># ----------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber">  79 </span><span class="Comment"></span>    <span class="Comment"># We start with methods which don't use system calls - they just</span></span>
<span class="line"><span class="LineNumber">  80 </span><span class="Comment"></span>    <span class="Comment"># manipulate paths.</span></span>
<span class="line"><span class="LineNumber">  81 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">  82 </span>    <span class="ResWord">class</span> <span class="ID">_BaseRoot</span><span class="Operator">(</span><span class="ID">object</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">  83 </span>        <span class="String">""" Represents a start location for a path.</span></span>
<span class="line"><span class="LineNumber">  84 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber">  85 </span><span class="String">        A Root is an object which may be the first element of a path tuple,</span></span>
<span class="line"><span class="LineNumber">  86 </span><span class="String">        and represents from where to start the path.</span></span>
<span class="line"><span class="LineNumber">  87 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber">  88 </span><span class="String">        On posix, there's only one: ROOT (singleton).</span></span>
<span class="line"><span class="LineNumber">  89 </span><span class="String">        On nt, there are a few:</span></span>
<span class="line"><span class="LineNumber">  90 </span><span class="String">          CURROOT - the root of the current drive (singleton)</span></span>
<span class="line"><span class="LineNumber">  91 </span><span class="String">          Drive(letter) - the root of a specific drive</span></span>
<span class="line"><span class="LineNumber">  92 </span><span class="String">          UnrootedDrive(letter) - the current working directory on a specific</span></span>
<span class="line"><span class="LineNumber">  93 </span><span class="String">                                  drive</span></span>
<span class="line"><span class="LineNumber">  94 </span><span class="String">          UNCRoot(host, mountpoint) - a UNC mount point</span></span>
<span class="line"><span class="LineNumber">  95 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">  96 </span><span class="String">        The class for each OS has its own root classes, which should inherit</span></span>
<span class="line"><span class="LineNumber">  97 </span><span class="String">        from _OSBaseRoot.</span></span>
<span class="line"><span class="LineNumber">  98 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber">  99 </span><span class="String">        str(root) should return the string name of the root. The string should</span></span>
<span class="line"><span class="LineNumber"> 100 </span><span class="String">        identify the root: two root elements with the same string should have</span></span>
<span class="line"><span class="LineNumber"> 101 </span><span class="String">        the same meaning. To allow meaningful sorting of path objects, root</span></span>
<span class="line"><span class="LineNumber"> 102 </span><span class="String">        objects can be compared to strings and other root objects. They are</span></span>
<span class="line"><span class="LineNumber"> 103 </span><span class="String">        smaller than all strings, and are compared with other root objects</span></span>
<span class="line"><span class="LineNumber"> 104 </span><span class="String">        according to their string name.</span></span>
<span class="line"><span class="LineNumber"> 105 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 106 </span><span class="String">        Every Root object should contain the "isabs" attribute, which is True</span></span>
<span class="line"><span class="LineNumber"> 107 </span><span class="String">        if changes in the current working directory won't change the meaning</span></span>
<span class="line"><span class="LineNumber"> 108 </span><span class="String">        of the root and False otherwise. (CURROOT and UnrootedDrive aren't</span></span>
<span class="line"><span class="LineNumber"> 109 </span><span class="String">        absolute)</span></span>
<span class="line"><span class="LineNumber"> 110 </span><span class="String">        If isabs is True, it should also implement the abspath() method, which</span></span>
<span class="line"><span class="LineNumber"> 111 </span><span class="String">        should return an absolute path object, equivalent to the root when the</span></span>
<span class="line"><span class="LineNumber"> 112 </span><span class="String">        call was made.</span></span>
<span class="line"><span class="LineNumber"> 113 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 114 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 115 </span></span>
<span class="line"><span class="LineNumber"> 116 </span>        <span class="ResWord">def</span> <span class="ID">abspath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 117 </span>            <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">abspath</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 118 </span>                <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> <span class="String">'This root is already absolute'</span></span>
<span class="line"><span class="LineNumber"> 119 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 120 </span>                <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> <span class="String">'abspath is abstract'</span></span>
<span class="line"><span class="LineNumber"> 121 </span></span>
<span class="line"><span class="LineNumber"> 122 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 123 </span>            <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> <span class="String">'__str__ is abstract'</span></span>
<span class="line"><span class="LineNumber"> 124 </span></span>
<span class="line"><span class="LineNumber"> 125 </span>        <span class="ResWord">def</span> <span class="ID">__cmp__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 126 </span>            <span class="ResWord">if</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 127 </span>                <span class="ResWord">return</span> <span class="Operator">-</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 128 </span>            <span class="ResWord">elif</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">,</span> <span class="ID">BasePath</span><span class="Operator">.</span><span class="ID">_BaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 129 </span>                <span class="ResWord">return</span> <span class="ID">cmp</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 130 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 131 </span>                <span class="ResWord">raise</span> <span class="ID">TypeError</span><span class="Operator">,</span> <span class="String">'Comparison not defined'</span></span>
<span class="line"><span class="LineNumber"> 132 </span></span>
<span class="line"><span class="LineNumber"> 133 </span>        <span class="ResWord">def</span> <span class="ID">__hash__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 134 </span>            <span class="Comment"># This allows path objects to be hashable</span></span>
<span class="line"><span class="LineNumber"> 135 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">hash</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 136 </span></span>
<span class="line"><span class="LineNumber"> 137 </span>    <span class="Comment"># _OSBaseRoot should be the base of the OS-specific root classes, which</span></span>
<span class="line"><span class="LineNumber"> 138 </span><span class="Comment"></span>    <span class="Comment"># should inherit from _BaseRoot</span></span>
<span class="line"><span class="LineNumber"> 139 </span><span class="Comment"></span>    <span class="ID">_OSBaseRoot</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 140 </span></span>
<span class="line"><span class="LineNumber"> 141 </span>    <span class="Comment"># These string constants should be filled by subclasses - they are real</span></span>
<span class="line"><span class="LineNumber"> 142 </span><span class="Comment"></span>    <span class="Comment"># directory names</span></span>
<span class="line"><span class="LineNumber"> 143 </span><span class="Comment"></span>    <span class="ID">curdir</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 144 </span>    <span class="ID">pardir</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 145 </span></span>
<span class="line"><span class="LineNumber"> 146 </span>    <span class="Comment"># These string constants are used by default implementations of methods,</span></span>
<span class="line"><span class="LineNumber"> 147 </span><span class="Comment"></span>    <span class="Comment"># but are not part of the interface - the whole idea is for the interface</span></span>
<span class="line"><span class="LineNumber"> 148 </span><span class="Comment"></span>    <span class="Comment"># to hide those details.</span></span>
<span class="line"><span class="LineNumber"> 149 </span><span class="Comment"></span>    <span class="ID">_sep</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 150 </span>    <span class="ID">_altsep</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 151 </span></span>
<span class="line"><span class="LineNumber"> 152 </span>    <span class="Error">@</span><span class="ID">staticmethod</span></span>
<span class="line"><span class="LineNumber"> 153 </span>    <span class="ResWord">def</span> <span class="ID">_parse_str</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 154 </span>        <span class="Comment"># Concrete path classes should implement _parse_str to get a path</span></span>
<span class="line"><span class="LineNumber"> 155 </span><span class="Comment"></span>        <span class="Comment"># string and return an iterable over path elements.</span></span>
<span class="line"><span class="LineNumber"> 156 </span><span class="Comment"></span>        <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> <span class="String">'_parse_str is abstract'</span></span>
<span class="line"><span class="LineNumber"> 157 </span></span>
<span class="line"><span class="LineNumber"> 158 </span>    <span class="Error">@</span><span class="ID">staticmethod</span></span>
<span class="line"><span class="LineNumber"> 159 </span>    <span class="ResWord">def</span> <span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">string</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 160 </span>        <span class="String">""" Normalize the case of one path element.</span></span>
<span class="line"><span class="LineNumber"> 161 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 162 </span><span class="String">        This default implementation returns string unchanged. On</span></span>
<span class="line"><span class="LineNumber"> 163 </span><span class="String">        case-insensitive platforms, it returns the normalized string.</span></span>
<span class="line"><span class="LineNumber"> 164 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 165 </span>        <span class="ResWord">return</span> <span class="ID">string</span></span>
<span class="line"><span class="LineNumber"> 166 </span></span>
<span class="line"><span class="LineNumber"> 167 </span>    <span class="Comment"># We make this method a property, to show that it doesn't use any</span></span>
<span class="line"><span class="LineNumber"> 168 </span><span class="Comment"></span>    <span class="Comment"># system calls.</span></span>
<span class="line"><span class="LineNumber"> 169 </span><span class="Comment"></span>    <span class="Comment"># Case-sensitive subclasses can redefine it to return self.</span></span>
<span class="line"><span class="LineNumber"> 170 </span><span class="Comment"></span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber"> 171 </span>    <span class="ResWord">def</span> <span class="ID">normcase</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 172 </span>        <span class="String">""" Return an equivalent path with case-normalized elements. """</span></span>
<span class="line"><span class="LineNumber"> 173 </span>        <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 174 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 175 </span>                                  <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 176 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 177 </span>            <span class="ResWord">def</span> <span class="ID">gen</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 178 </span>                <span class="ID">it</span> <span class="Operator">=</span> <span class="ID">iter</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 179 </span>                <span class="ResWord">yield</span> <span class="ID">it</span><span class="Operator">.</span><span class="ID">next</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 180 </span>                <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">it</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 181 </span>                    <span class="ResWord">yield</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 182 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">gen</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 183 </span></span>
<span class="line"><span class="LineNumber"> 184 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber"> 185 </span>    <span class="ResWord">def</span> <span class="ID">_normalize_elements</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">elements</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 186 </span>        <span class="Comment"># This method gets an iterable over path elements.</span></span>
<span class="line"><span class="LineNumber"> 187 </span><span class="Comment"></span>        <span class="Comment"># It should return an iterator over normalized path elements -</span></span>
<span class="line"><span class="LineNumber"> 188 </span><span class="Comment"></span>        <span class="Comment"># that is, curdir elements should be ignored.</span></span>
<span class="line"><span class="LineNumber"> 189 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 190 </span>        <span class="ResWord">for</span> <span class="ID">i</span><span class="Operator">,</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">enumerate</span><span class="Operator">(</span><span class="ID">elements</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 191 </span>            <span class="ResWord">if</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 192 </span>                <span class="ResWord">if</span> <span class="ID">element</span> <span class="Operator">!=</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">curdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 193 </span>                    <span class="ResWord">if</span> <span class="Operator">(</span><span class="ResWord">not</span> <span class="ID">element</span> <span class="ResWord">or</span></span>
<span class="line"><span class="LineNumber"> 194 </span>                        <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_sep</span> <span class="ResWord">in</span> <span class="ID">element</span> <span class="ResWord">or</span></span>
<span class="line"><span class="LineNumber"> 195 </span>                        <span class="Operator">(</span><span class="ID">cls</span><span class="Operator">.</span><span class="ID">_altsep</span> <span class="ResWord">and</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_altsep</span> <span class="ResWord">in</span> <span class="ID">element</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 196 </span>                        <span class="Comment"># Those elements will cause path(str(x)) != x</span></span>
<span class="line"><span class="LineNumber"> 197 </span><span class="Comment"></span>                        <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"Element %r is invalid"</span> <span class="Operator">%</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 198 </span>                    <span class="ResWord">yield</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 199 </span>            <span class="ResWord">elif</span> <span class="ID">i</span> <span class="Operator">==</span> <span class="Number">0</span> <span class="ResWord">and</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">,</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_OSBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 200 </span>                <span class="ResWord">yield</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 201 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 202 </span>                <span class="ResWord">raise</span> <span class="ID">TypeError</span><span class="Operator">,</span> <span class="String">"Element %r is of a wrong type"</span> <span class="Operator">%</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 203 </span></span>
<span class="line"><span class="LineNumber"> 204 </span>    <span class="ResWord">def</span> <span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">arg</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 205 </span>        <span class="String">""" Create a new path object.</span></span>
<span class="line"><span class="LineNumber"> 206 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 207 </span><span class="String">        If arg isn't given, an empty path, which represents the current</span></span>
<span class="line"><span class="LineNumber"> 208 </span><span class="String">        working directory, is returned.</span></span>
<span class="line"><span class="LineNumber"> 209 </span><span class="String">        If arg is a string, it is parsed into a logical path.</span></span>
<span class="line"><span class="LineNumber"> 210 </span><span class="String">        If arg is an iterable over path elements, a new path is created from</span></span>
<span class="line"><span class="LineNumber"> 211 </span><span class="String">        them.</span></span>
<span class="line"><span class="LineNumber"> 212 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 213 </span>        <span class="ResWord">if</span> <span class="ID">arg</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 214 </span>            <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 215 </span>        <span class="ResWord">elif</span> <span class="ID">type</span><span class="Operator">(</span><span class="ID">arg</span><span class="Operator">)</span> <span class="ResWord">is</span> <span class="ID">cls</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 216 </span>            <span class="ResWord">return</span> <span class="ID">arg</span></span>
<span class="line"><span class="LineNumber"> 217 </span>        <span class="ResWord">elif</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">arg</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 218 </span>            <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_parse_str</span><span class="Operator">(</span><span class="ID">arg</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 219 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 220 </span>            <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_normalize_elements</span><span class="Operator">(</span><span class="ID">arg</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 221 </span></span>
<span class="line"><span class="LineNumber"> 222 </span>    <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">arg</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 223 </span>        <span class="Comment"># Since paths are immutable, we can cache the string representation</span></span>
<span class="line"><span class="LineNumber"> 224 </span><span class="Comment"></span>        <span class="ID">self</span><span class="Operator">.</span><span class="ID">_cached_str</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 225 </span></span>
<span class="line"><span class="LineNumber"> 226 </span>    <span class="ResWord">def</span> <span class="ID">_build_str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 227 </span>        <span class="Comment"># Return a string representation of self.</span></span>
<span class="line"><span class="LineNumber"> 228 </span><span class="Comment"></span>        <span class="Comment"># </span></span>
<span class="line"><span class="LineNumber"> 229 </span><span class="Comment"></span>        <span class="Comment"># This is a default implementation, which may be overriden by</span></span>
<span class="line"><span class="LineNumber"> 230 </span><span class="Comment"></span>        <span class="Comment"># subclasses (form example, MacPath)</span></span>
<span class="line"><span class="LineNumber"> 231 </span><span class="Comment"></span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 232 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">curdir</span></span>
<span class="line"><span class="LineNumber"> 233 </span>        <span class="ResWord">elif</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_OSBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 234 </span>            <span class="ResWord">return</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">)</span> <span class="Operator">+</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_sep</span><span class="Operator">.</span><span class="ID">join</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">1</span><span class="Operator">:</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 235 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 236 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_sep</span><span class="Operator">.</span><span class="ID">join</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 237 </span></span>
<span class="line"><span class="LineNumber"> 238 </span>    <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 239 </span>        <span class="String">""" Return a string representation of self. """</span></span>
<span class="line"><span class="LineNumber"> 240 </span>        <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_cached_str</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 241 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">_cached_str</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_build_str</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 242 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_cached_str</span></span>
<span class="line"><span class="LineNumber"> 243 </span></span>
<span class="line"><span class="LineNumber"> 244 </span>    <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 245 </span>        <span class="Comment"># We want path, not the real class name.</span></span>
<span class="line"><span class="LineNumber"> 246 </span><span class="Comment"></span>        <span class="ResWord">return</span> <span class="String">'path(%r)'</span> <span class="Operator">%</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 247 </span></span>
<span class="line"><span class="LineNumber"> 248 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber"> 249 </span>    <span class="ResWord">def</span> <span class="ID">isabs</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 250 </span>        <span class="String">""" Return whether this path represent an absolute path.</span></span>
<span class="line"><span class="LineNumber"> 251 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 252 </span><span class="String">        An absolute path is a path whose meaning doesn't change when the</span></span>
<span class="line"><span class="LineNumber"> 253 </span><span class="String">        the current working directory changes.</span></span>
<span class="line"><span class="LineNumber"> 254 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 255 </span><span class="String">        (Note that this is not the same as "not self.isrelative")</span></span>
<span class="line"><span class="LineNumber"> 256 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 257 </span>        <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span> <span class="Operator">&gt;</span> <span class="Number">0</span> <span class="ResWord">and</span> \
               <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_OSBaseRoot</span><span class="Operator">)</span> <span class="ResWord">and</span> \
               <span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">isabs</span></span>
<span class="line"><span class="LineNumber"> 258 </span></span>
<span class="line"><span class="LineNumber"> 259 </span>    <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber"> 260 </span>    <span class="ResWord">def</span> <span class="ID">isrel</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 261 </span>        <span class="String">""" Return whether this path represents a relative path.</span></span>
<span class="line"><span class="LineNumber"> 262 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 263 </span><span class="String">        A relative path is a path without a root element, so it can be</span></span>
<span class="line"><span class="LineNumber"> 264 </span><span class="String">        concatenated to other paths.</span></span>
<span class="line"><span class="LineNumber"> 265 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 266 </span><span class="String">        (Note that this is not the same as "not self.isabs")</span></span>
<span class="line"><span class="LineNumber"> 267 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 268 </span>        <span class="ResWord">return</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span> <span class="Operator">==</span> <span class="Number">0</span> <span class="ResWord">or</span> \
               <span class="ResWord">not</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_OSBaseRoot</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 269 </span></span>
<span class="line"><span class="LineNumber"> 270 </span>    <span class="Comment"># Wrap a few tuple methods to return path objects</span></span>
<span class="line"><span class="LineNumber"> 271 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 272 </span>    <span class="ResWord">def</span> <span class="ID">__add__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 273 </span>        <span class="ID">other</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 274 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">other</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 275 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"Right operand should be a relative path"</span></span>
<span class="line"><span class="LineNumber"> 276 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">itertools</span><span class="Operator">.</span><span class="ID">chain</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 277 </span></span>
<span class="line"><span class="LineNumber"> 278 </span>    <span class="ResWord">def</span> <span class="ID">__radd__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 279 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 280 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"Right operand should be a relative path"</span></span>
<span class="line"><span class="LineNumber"> 281 </span>        <span class="ID">other</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 282 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">itertools</span><span class="Operator">.</span><span class="ID">chain</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 283 </span></span>
<span class="line"><span class="LineNumber"> 284 </span>    <span class="ResWord">def</span> <span class="ID">__getslice__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 285 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__getslice__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 286 </span></span>
<span class="line"><span class="LineNumber"> 287 </span>    <span class="ResWord">def</span> <span class="ID">__mul__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 288 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 289 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"Only relative paths can be multiplied"</span></span>
<span class="line"><span class="LineNumber"> 290 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__mul__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 291 </span></span>
<span class="line"><span class="LineNumber"> 292 </span>    <span class="ResWord">def</span> <span class="ID">__rmul__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 293 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 294 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"Only relative paths can be multiplied"</span></span>
<span class="line"><span class="LineNumber"> 295 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__rmul__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 296 </span></span>
<span class="line"><span class="LineNumber"> 297 </span>    <span class="ResWord">def</span> <span class="ID">__eq__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 298 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__eq__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 299 </span>    <span class="ResWord">def</span> <span class="ID">__ge__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 300 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__ge__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 301 </span>    <span class="ResWord">def</span> <span class="ID">__gt__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 302 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__gt__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 303 </span>    <span class="ResWord">def</span> <span class="ID">__le__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 304 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__le__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 305 </span>    <span class="ResWord">def</span> <span class="ID">__lt__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 306 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__lt__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 307 </span>    <span class="ResWord">def</span> <span class="ID">__ne__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 308 </span>        <span class="ResWord">return</span> <span class="ID">tuple</span><span class="Operator">.</span><span class="ID">__ne__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 309 </span></span>
<span class="line"><span class="LineNumber"> 310 </span></span>
<span class="line"><span class="LineNumber"> 311 </span>    <span class="Comment"># ----------------------------------------------------------------</span></span>
<span class="line"><span class="LineNumber"> 312 </span><span class="Comment"></span>    <span class="Comment"># Now come the methods which use system calls.</span></span>
<span class="line"><span class="LineNumber"> 313 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 314 </span>    <span class="Comment"># --- Path transformation which use system calls</span></span>
<span class="line"><span class="LineNumber"> 315 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 316 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber"> 317 </span>    <span class="ResWord">def</span> <span class="ID">cwd</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 318 </span>        <span class="ResWord">return</span> <span class="ID">cls</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">getcwd</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 319 </span></span>
<span class="line"><span class="LineNumber"> 320 </span>    <span class="ResWord">def</span> <span class="ID">chdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 321 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">chdir</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 322 </span></span>
<span class="line"><span class="LineNumber"> 323 </span>    <span class="ResWord">def</span> <span class="ID">abspath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 324 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 325 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">cwd</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 326 </span>        <span class="ResWord">if</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_OSBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 327 </span>            <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">isabs</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 328 </span>                <span class="ResWord">return</span> <span class="ID">self</span></span>
<span class="line"><span class="LineNumber"> 329 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 330 </span>                <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">abspath</span><span class="Operator">(</span><span class="Operator">)</span> <span class="Operator">+</span> <span class="ID">self</span><span class="Operator">[</span><span class="Number">1</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 331 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 332 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">cwd</span><span class="Operator">(</span><span class="Operator">)</span> <span class="Operator">+</span> <span class="ID">self</span></span>
<span class="line"><span class="LineNumber"> 333 </span></span>
<span class="line"><span class="LineNumber"> 334 </span>    <span class="ResWord">def</span> <span class="ID">realpath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 335 </span>        <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">path</span><span class="Operator">.</span><span class="ID">realpath</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 336 </span></span>
<span class="line"><span class="LineNumber"> 337 </span>    <span class="ResWord">def</span> <span class="ID">relpathto</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">dst</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 338 </span>        <span class="String">""" Return a relative path from self to dest.</span></span>
<span class="line"><span class="LineNumber"> 339 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 340 </span><span class="String">        This method examines self.realpath() and dest.realpath(). If</span></span>
<span class="line"><span class="LineNumber"> 341 </span><span class="String">        they have the same root element, a path in the form</span></span>
<span class="line"><span class="LineNumber"> 342 </span><span class="String">        path([path.pardir, path.pardir, ..., dir1, dir2, ...])</span></span>
<span class="line"><span class="LineNumber"> 343 </span><span class="String">        is returned. If they have different root elements,</span></span>
<span class="line"><span class="LineNumber"> 344 </span><span class="String">        dest.realpath() is returned.</span></span>
<span class="line"><span class="LineNumber"> 345 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 346 </span>        <span class="ID">src</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">realpath</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 347 </span>        <span class="ID">dst</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">realpath</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 348 </span></span>
<span class="line"><span class="LineNumber"> 349 </span>        <span class="ResWord">if</span> <span class="ID">src</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="ID">dst</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 350 </span>            <span class="Comment"># They have the same root</span></span>
<span class="line"><span class="LineNumber"> 351 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 352 </span>            <span class="Comment"># find the length of the equal prefix</span></span>
<span class="line"><span class="LineNumber"> 353 </span><span class="Comment"></span>            <span class="ID">i</span> <span class="Operator">=</span> <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 354 </span>            <span class="ResWord">while</span> <span class="ID">i</span> <span class="Operator">&lt;</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">src</span><span class="Operator">)</span> <span class="ResWord">and</span> <span class="ID">i</span> <span class="Operator">&lt;</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span> <span class="ResWord">and</span> \
                  <span class="ID">self</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">src</span><span class="Operator">[</span><span class="ID">i</span><span class="Operator">]</span><span class="Operator">)</span> <span class="Operator">==</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">[</span><span class="ID">i</span><span class="Operator">]</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 355 </span>                <span class="ID">i</span> <span class="Operator">+=</span> <span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 356 </span></span>
<span class="line"><span class="LineNumber"> 357 </span>            <span class="ResWord">return</span> <span class="Operator">[</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">pardir</span><span class="Operator">]</span> <span class="Operator">*</span> <span class="Operator">(</span><span class="ID">len</span><span class="Operator">(</span><span class="ID">src</span><span class="Operator">)</span> <span class="Operator">-</span> <span class="ID">i</span><span class="Operator">)</span> <span class="Operator">+</span> <span class="ID">dst</span><span class="Operator">[</span><span class="ID">i</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 358 </span></span>
<span class="line"><span class="LineNumber"> 359 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 360 </span>            <span class="Comment"># They don't have the same root</span></span>
<span class="line"><span class="LineNumber"> 361 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">dst</span></span>
<span class="line"><span class="LineNumber"> 362 </span></span>
<span class="line"><span class="LineNumber"> 363 </span></span>
<span class="line"><span class="LineNumber"> 364 </span></span>
<span class="line"><span class="LineNumber"> 365 </span></span>
<span class="line"><span class="LineNumber"> 366 </span>    <span class="Comment"># --- Expand</span></span>
<span class="line"><span class="LineNumber"> 367 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 368 </span>    <span class="ResWord">def</span> <span class="ID">expanduser</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 369 </span>        <span class="ResWord">return</span> <span class="ID">path</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">path</span><span class="Operator">.</span><span class="ID">expanduser</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 370 </span></span>
<span class="line"><span class="LineNumber"> 371 </span>    <span class="ResWord">def</span> <span class="ID">expandvars</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 372 </span>        <span class="ResWord">return</span> <span class="ID">path</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">path</span><span class="Operator">.</span><span class="ID">expandvars</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 373 </span></span>
<span class="line"><span class="LineNumber"> 374 </span></span>
<span class="line"><span class="LineNumber"> 375 </span>    <span class="Comment"># --- Info about the path</span></span>
<span class="line"><span class="LineNumber"> 376 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 377 </span>    <span class="ResWord">def</span> <span class="ID">stat</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 378 </span>        <span class="ResWord">return</span> <span class="ID">StatWrapper</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 379 </span></span>
<span class="line"><span class="LineNumber"> 380 </span>    <span class="ResWord">def</span> <span class="ID">exists</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 381 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 382 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 383 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 384 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 385 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 386 </span>            <span class="ResWord">return</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber"> 387 </span></span>
<span class="line"><span class="LineNumber"> 388 </span>    <span class="ResWord">def</span> <span class="ID">isdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 389 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 390 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">isdir</span></span>
<span class="line"><span class="LineNumber"> 391 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 392 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 393 </span></span>
<span class="line"><span class="LineNumber"> 394 </span>    <span class="ResWord">def</span> <span class="ID">isfile</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 395 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 396 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">isfile</span></span>
<span class="line"><span class="LineNumber"> 397 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 398 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 399 </span></span>
<span class="line"><span class="LineNumber"> 400 </span>    <span class="ResWord">def</span> <span class="ID">lstat</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 401 </span>        <span class="ResWord">return</span> <span class="ID">StatWrapper</span><span class="Operator">(</span><span class="ID">os</span><span class="Operator">.</span><span class="ID">lstat</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 402 </span></span>
<span class="line"><span class="LineNumber"> 403 </span>    <span class="ResWord">def</span> <span class="ID">lexists</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 404 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 405 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">lstat</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 406 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 407 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 408 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 409 </span>            <span class="ResWord">return</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber"> 410 </span></span>
<span class="line"><span class="LineNumber"> 411 </span>    <span class="ResWord">def</span> <span class="ID">lisdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 412 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 413 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">lisdir</span></span>
<span class="line"><span class="LineNumber"> 414 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 415 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 416 </span></span>
<span class="line"><span class="LineNumber"> 417 </span>    <span class="ResWord">def</span> <span class="ID">lisfile</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 418 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 419 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">lisfile</span></span>
<span class="line"><span class="LineNumber"> 420 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 421 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 422 </span></span>
<span class="line"><span class="LineNumber"> 423 </span>    <span class="ResWord">def</span> <span class="ID">islink</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 424 </span>        <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 425 </span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">lstat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">islink</span></span>
<span class="line"><span class="LineNumber"> 426 </span>        <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 427 </span>            <span class="ResWord">return</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 428 </span></span>
<span class="line"><span class="LineNumber"> 429 </span>    <span class="ResWord">def</span> <span class="ID">ismount</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 430 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">path</span><span class="Operator">.</span><span class="ID">ismount</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 431 </span></span>
<span class="line"><span class="LineNumber"> 432 </span>    <span class="ResWord">def</span> <span class="ID">access</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 433 </span>        <span class="String">""" Return true if current user has access to this path.</span></span>
<span class="line"><span class="LineNumber"> 434 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 435 </span><span class="String">        mode - One of the constants os.F_OK, os.R_OK, os.W_OK, os.X_OK</span></span>
<span class="line"><span class="LineNumber"> 436 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 437 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">access</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 438 </span></span>
<span class="line"><span class="LineNumber"> 439 </span>    <span class="Comment"># Additional methods in subclasses:</span></span>
<span class="line"><span class="LineNumber"> 440 </span><span class="Comment"></span>    <span class="Comment"># statvfs (PosixPath)</span></span>
<span class="line"><span class="LineNumber"> 441 </span><span class="Comment"></span>    <span class="Comment"># pathconf (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 442 </span><span class="Comment"></span>    <span class="Comment"># samefile (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 443 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 444 </span></span>
<span class="line"><span class="LineNumber"> 445 </span>    <span class="Comment"># --- Modifying operations on files and directories</span></span>
<span class="line"><span class="LineNumber"> 446 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 447 </span>    <span class="ResWord">def</span> <span class="ID">utime</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">times</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 448 </span>        <span class="String">""" Set the access and modified times of this file. """</span></span>
<span class="line"><span class="LineNumber"> 449 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">utime</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">times</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 450 </span></span>
<span class="line"><span class="LineNumber"> 451 </span>    <span class="ResWord">def</span> <span class="ID">chmod</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 452 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">chmod</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 453 </span></span>
<span class="line"><span class="LineNumber"> 454 </span>    <span class="ResWord">def</span> <span class="ID">rename</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">new</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 455 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">rename</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">new</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 456 </span></span>
<span class="line"><span class="LineNumber"> 457 </span>    <span class="Comment"># Additional methods in subclasses:</span></span>
<span class="line"><span class="LineNumber"> 458 </span><span class="Comment"></span>    <span class="Comment"># chown (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 459 </span><span class="Comment"></span>    <span class="Comment"># lchown (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 460 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 461 </span></span>
<span class="line"><span class="LineNumber"> 462 </span>    <span class="Comment"># --- Create/delete operations on directories</span></span>
<span class="line"><span class="LineNumber"> 463 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 464 </span>    <span class="ResWord">def</span> <span class="ID">mkdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">=</span><span class="Number">0777</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 465 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">mkdir</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 466 </span></span>
<span class="line"><span class="LineNumber"> 467 </span>    <span class="ResWord">def</span> <span class="ID">makedirs</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">=</span><span class="Number">0777</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 468 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">makedirs</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">mode</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 469 </span></span>
<span class="line"><span class="LineNumber"> 470 </span>    <span class="ResWord">def</span> <span class="ID">rmdir</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 471 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">rmdir</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 472 </span></span>
<span class="line"><span class="LineNumber"> 473 </span>    <span class="ResWord">def</span> <span class="ID">removedirs</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">base</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 474 </span>        <span class="String">""" Remove empty directories recursively.</span></span>
<span class="line"><span class="LineNumber"> 475 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 476 </span><span class="String">        If the directory is empty, remove it. If the parent directory becomes</span></span>
<span class="line"><span class="LineNumber"> 477 </span><span class="String">        empty, remove it too. Continue until a directory can't be removed,</span></span>
<span class="line"><span class="LineNumber"> 478 </span><span class="String">        because it's not empty or for other reasons.</span></span>
<span class="line"><span class="LineNumber"> 479 </span><span class="String">        If base is given, it should be a prefix of self. base won't be removed</span></span>
<span class="line"><span class="LineNumber"> 480 </span><span class="String">        even if it becomes empty.</span></span>
<span class="line"><span class="LineNumber"> 481 </span><span class="String">        Note: only directories explicitly listed in the path will be removed.</span></span>
<span class="line"><span class="LineNumber"> 482 </span><span class="String">        This means that if self is a relative path, predecesors of the</span></span>
<span class="line"><span class="LineNumber"> 483 </span><span class="String">        current working directory won't be removed.</span></span>
<span class="line"><span class="LineNumber"> 484 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 485 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">isdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 486 </span>            <span class="ResWord">raise</span> <span class="ID">OSError</span><span class="Operator">,</span> <span class="String">'removedirs only works on directories.'</span></span>
<span class="line"><span class="LineNumber"> 487 </span>        <span class="ID">base</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">base</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 488 </span>        <span class="ResWord">if</span> <span class="ID">base</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 489 </span>            <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">[</span><span class="Operator">:</span><span class="ID">len</span><span class="Operator">(</span><span class="ID">base</span><span class="Operator">)</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="ID">base</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 490 </span>                <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">'base should be a prefix of self.'</span></span>
<span class="line"><span class="LineNumber"> 491 </span>            <span class="ID">stopat</span> <span class="Operator">=</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">base</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 492 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 493 </span>            <span class="ID">stopat</span> <span class="Operator">=</span> <span class="Number">0</span></span>
<span class="line"><span class="LineNumber"> 494 </span>        <span class="ResWord">for</span> <span class="ID">i</span> <span class="ResWord">in</span> <span class="ID">xrange</span><span class="Operator">(</span><span class="ID">len</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">stopat</span><span class="Operator">,</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 495 </span>            <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 496 </span>                <span class="ID">self</span><span class="Operator">[</span><span class="Operator">:</span><span class="ID">i</span><span class="Operator">]</span><span class="Operator">.</span><span class="ID">rmdir</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 497 </span>            <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 498 </span>                <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"> 499 </span></span>
<span class="line"><span class="LineNumber"> 500 </span>    <span class="ResWord">def</span> <span class="ID">rmtree</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 501 </span>        <span class="ResWord">return</span> <span class="ID">shutil</span><span class="Operator">.</span><span class="ID">rmtree</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 502 </span></span>
<span class="line"><span class="LineNumber"> 503 </span></span>
<span class="line"><span class="LineNumber"> 504 </span>    <span class="Comment"># --- Modifying operations on files</span></span>
<span class="line"><span class="LineNumber"> 505 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 506 </span>    <span class="ResWord">def</span> <span class="ID">touch</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 507 </span>        <span class="String">""" Set the access/modified times of this file to the current time.</span></span>
<span class="line"><span class="LineNumber"> 508 </span><span class="String">        Create the file if it does not exist.</span></span>
<span class="line"><span class="LineNumber"> 509 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 510 </span>        <span class="ID">fd</span> <span class="Operator">=</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">open</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">O_WRONLY</span> <span class="Operator">|</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">O_CREAT</span><span class="Operator">,</span> <span class="Number">0666</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 511 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">close</span><span class="Operator">(</span><span class="ID">fd</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 512 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">utime</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 513 </span></span>
<span class="line"><span class="LineNumber"> 514 </span>    <span class="ResWord">def</span> <span class="ID">remove</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 515 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">remove</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 516 </span></span>
<span class="line"><span class="LineNumber"> 517 </span>    <span class="ResWord">def</span> <span class="ID">copy</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">dst</span><span class="Operator">,</span> <span class="ID">copystat</span><span class="Operator">=</span><span class="ID">False</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 518 </span>        <span class="String">""" Copy file from self to dst.</span></span>
<span class="line"><span class="LineNumber"> 519 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 520 </span><span class="String">        If copystat is False, copy data and mode bits ("cp self dst").</span></span>
<span class="line"><span class="LineNumber"> 521 </span><span class="String">        If copystat is True, copy data and all stat info ("cp -p self dst").</span></span>
<span class="line"><span class="LineNumber"> 522 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 523 </span><span class="String">        The destination may be a directory. If so, a file with the same base</span></span>
<span class="line"><span class="LineNumber"> 524 </span><span class="String">        name as self will be created in that directory.</span></span>
<span class="line"><span class="LineNumber"> 525 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 526 </span>        <span class="ID">dst</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 527 </span>        <span class="ResWord">if</span> <span class="ID">dst</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">.</span><span class="ID">isdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 528 </span>            <span class="ID">dst</span> <span class="Operator">+=</span> <span class="ID">self</span><span class="Operator">[</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 529 </span>        <span class="ID">shutil</span><span class="Operator">.</span><span class="ID">copyfile</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 530 </span>        <span class="ResWord">if</span> <span class="ID">copystat</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 531 </span>            <span class="ID">shutil</span><span class="Operator">.</span><span class="ID">copystat</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 532 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 533 </span>            <span class="ID">shutil</span><span class="Operator">.</span><span class="ID">copymode</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 534 </span></span>
<span class="line"><span class="LineNumber"> 535 </span>    <span class="ResWord">def</span> <span class="ID">move</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">dst</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 536 </span>        <span class="ID">dst</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 537 </span>        <span class="ResWord">return</span> <span class="ID">shutil</span><span class="Operator">.</span><span class="ID">move</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">dst</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 538 </span></span>
<span class="line"><span class="LineNumber"> 539 </span></span>
<span class="line"><span class="LineNumber"> 540 </span>    <span class="Comment"># --- Links</span></span>
<span class="line"><span class="LineNumber"> 541 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 542 </span>    <span class="Comment"># In subclasses:</span></span>
<span class="line"><span class="LineNumber"> 543 </span><span class="Comment"></span>    <span class="Comment"># link (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 544 </span><span class="Comment"></span>    <span class="Comment"># writelink (PosixPath) - what about MacPath?</span></span>
<span class="line"><span class="LineNumber"> 545 </span><span class="Comment"></span>    <span class="Comment"># readlink (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 546 </span><span class="Comment"></span>    <span class="Comment"># readlinkpath (PosixPath, XXXMacPath)</span></span>
<span class="line"><span class="LineNumber"> 547 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 548 </span></span>
<span class="line"><span class="LineNumber"> 549 </span>    <span class="Comment"># --- Extra</span></span>
<span class="line"><span class="LineNumber"> 550 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 551 </span>    <span class="Comment"># In subclasses:</span></span>
<span class="line"><span class="LineNumber"> 552 </span><span class="Comment"></span>    <span class="Comment"># mkfifo (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 553 </span><span class="Comment"></span>    <span class="Comment"># mknod (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 554 </span><span class="Comment"></span>    <span class="Comment"># chroot (PosixPath, XXX MacPath)</span></span>
<span class="line"><span class="LineNumber"> 555 </span><span class="Comment"></span>    <span class="Comment">#</span></span>
<span class="line"><span class="LineNumber"> 556 </span><span class="Comment"></span>    <span class="Comment"># startfile (NTPath)</span></span>
<span class="line"><span class="LineNumber"> 557 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 558 </span></span>
<span class="line"><span class="LineNumber"> 559 </span>    <span class="Comment"># --- Globbing</span></span>
<span class="line"><span class="LineNumber"> 560 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 561 </span>    <span class="Comment"># If the OS supports it, _id should be a function that gets a stat object</span></span>
<span class="line"><span class="LineNumber"> 562 </span><span class="Comment"></span>    <span class="Comment"># and returns a unique id of a file.</span></span>
<span class="line"><span class="LineNumber"> 563 </span><span class="Comment"></span>    <span class="Comment"># It the OS doesn't support it, it should be None.</span></span>
<span class="line"><span class="LineNumber"> 564 </span><span class="Comment"></span>    <span class="ID">_id</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 565 </span></span>
<span class="line"><span class="LineNumber"> 566 </span>    <span class="Error">@</span><span class="ID">staticmethod</span></span>
<span class="line"><span class="LineNumber"> 567 </span>    <span class="ResWord">def</span> <span class="ID">_match_element</span><span class="Operator">(</span><span class="ID">comp_element</span><span class="Operator">,</span> <span class="ID">element</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 568 </span>        <span class="Comment"># Does a filename match a compiled pattern element?</span></span>
<span class="line"><span class="LineNumber"> 569 </span><span class="Comment"></span>        <span class="Comment"># The filename should be normcased.</span></span>
<span class="line"><span class="LineNumber"> 570 </span><span class="Comment"></span>        <span class="ResWord">if</span> <span class="ID">comp_element</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 571 </span>            <span class="ResWord">return</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber"> 572 </span>        <span class="ResWord">elif</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">comp_element</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 573 </span>            <span class="ResWord">return</span> <span class="ID">comp_element</span> <span class="Operator">==</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 574 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 575 </span>            <span class="ResWord">return</span> <span class="ID">comp_element</span><span class="Operator">.</span><span class="ID">match</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 576 </span></span>
<span class="line"><span class="LineNumber"> 577 </span>    <span class="ResWord">def</span> <span class="ID">_glob</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">pth</span><span class="Operator">,</span> <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber"> 578 </span>              <span class="ID">positions</span><span class="Operator">,</span> <span class="ID">on_path</span><span class="Operator">,</span> <span class="ID">stat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 579 </span>        <span class="String">""" The recursive function used by glob.</span></span>
<span class="line"><span class="LineNumber"> 580 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 581 </span><span class="String">        This version treats symbolic links as files. Broken symlinks won't be</span></span>
<span class="line"><span class="LineNumber"> 582 </span><span class="String">        listed.</span></span>
<span class="line"><span class="LineNumber"> 583 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 584 </span><span class="String">        pth is a dir in which we search.</span></span>
<span class="line"><span class="LineNumber"> 585 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 586 </span><span class="String">        comp_pattern is the compiled pattern. It's a sequence which should</span></span>
<span class="line"><span class="LineNumber"> 587 </span><span class="String">        consist of three kinds of elements:</span></span>
<span class="line"><span class="LineNumber"> 588 </span><span class="String">        * None - matches any number of subdirectories, including 0.</span></span>
<span class="line"><span class="LineNumber"> 589 </span><span class="String">        * a string - a normalized name, when exactly one name can be matched.</span></span>
<span class="line"><span class="LineNumber"> 590 </span><span class="String">        * a regexp - for testing if normalized names match.</span></span>
<span class="line"><span class="LineNumber"> 591 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 592 </span><span class="String">        positions is a sequence of positions on comp_pattern that children of</span></span>
<span class="line"><span class="LineNumber"> 593 </span><span class="String">        path may match. On the first call, if will be [0].</span></span>
<span class="line"><span class="LineNumber"> 594 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 595 </span><span class="String">        on_path is a set of inode identifiers on path, or None if circles</span></span>
<span class="line"><span class="LineNumber"> 596 </span><span class="String">        shouldn't be checked.</span></span>
<span class="line"><span class="LineNumber"> 597 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 598 </span><span class="String">        stat is the appropriate stat function - cls.stat or cls.lstat.</span></span>
<span class="line"><span class="LineNumber"> 599 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 600 </span></span>
<span class="line"><span class="LineNumber"> 601 </span>        <span class="ResWord">if</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">positions</span><span class="Operator">)</span> <span class="Operator">==</span> <span class="Number">1</span> <span class="ResWord">and</span> <span class="ID">isinstance</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">[</span><span class="ID">positions</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 602 </span>            <span class="Comment"># We don't have to listdir if exactly one file name can match.</span></span>
<span class="line"><span class="LineNumber"> 603 </span><span class="Comment"></span>            <span class="Comment"># Since we always stat the files, it's ok if the file doesn't exist.</span></span>
<span class="line"><span class="LineNumber"> 604 </span><span class="Comment"></span>            <span class="ID">listdir</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="ID">comp_pattern</span><span class="Operator">[</span><span class="ID">positions</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">]</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 605 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 606 </span>            <span class="ID">listdir</span> <span class="Operator">=</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">listdir</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">pth</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 607 </span>            <span class="ID">listdir</span><span class="Operator">.</span><span class="ID">sort</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 608 </span></span>
<span class="line"><span class="LineNumber"> 609 </span>        <span class="ResWord">for</span> <span class="ID">subfile</span> <span class="ResWord">in</span> <span class="ID">listdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 610 </span>            <span class="ID">newpth</span> <span class="Operator">=</span> <span class="ID">pth</span> <span class="Operator">+</span> <span class="ID">subfile</span></span>
<span class="line"><span class="LineNumber"> 611 </span>            <span class="Comment"># We don't strictly need to stat a file if we don't follow symlinks</span></span>
<span class="line"><span class="LineNumber"> 612 </span><span class="Comment"></span>            <span class="Comment"># AND positions == [len(comp_pattern)-1] AND</span></span>
<span class="line"><span class="LineNumber"> 613 </span><span class="Comment"></span>            <span class="Comment"># not isinstance(comp_pattern[-1], str), but do me a favour...</span></span>
<span class="line"><span class="LineNumber"> 614 </span><span class="Comment"></span>            <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 615 </span>                <span class="ID">st</span> <span class="Operator">=</span> <span class="ID">stat</span><span class="Operator">(</span><span class="ID">newpth</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 616 </span>            <span class="ResWord">except</span> <span class="ID">OSError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 617 </span>                <span class="ResWord">continue</span></span>
<span class="line"><span class="LineNumber"> 618 </span>            <span class="ID">newpositions</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 619 </span>            <span class="ID">subfilenorm</span> <span class="Operator">=</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">subfile</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 620 </span></span>
<span class="line"><span class="LineNumber"> 621 </span>            <span class="ResWord">if</span> <span class="ID">topdown</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 622 </span>                <span class="Comment"># If not topdown, it happens after we handle subdirs</span></span>
<span class="line"><span class="LineNumber"> 623 </span><span class="Comment"></span>                <span class="ResWord">if</span> <span class="ID">positions</span><span class="Operator">[</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span> <span class="Operator">-</span> <span class="Number">1</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 624 </span>                    <span class="ResWord">if</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_match_element</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">[</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">subfilenorm</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 625 </span>                        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="Operator">(</span><span class="Operator">(</span><span class="ID">onlydirs</span> <span class="ResWord">and</span> <span class="ResWord">not</span> <span class="ID">st</span><span class="Operator">.</span><span class="ID">isdir</span><span class="Operator">)</span> <span class="ResWord">or</span></span>
<span class="line"><span class="LineNumber"> 626 </span>                                <span class="Operator">(</span><span class="ID">onlyfiles</span> <span class="ResWord">and</span> <span class="ResWord">not</span> <span class="ID">st</span><span class="Operator">.</span><span class="ID">isfile</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 627 </span>                            <span class="ResWord">yield</span> <span class="ID">newpth</span></span>
<span class="line"><span class="LineNumber"> 628 </span></span>
<span class="line"><span class="LineNumber"> 629 </span>            <span class="ResWord">for</span> <span class="ID">pos</span> <span class="ResWord">in</span> <span class="ID">reversed</span><span class="Operator">(</span><span class="ID">positions</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 630 </span>                <span class="ResWord">if</span> <span class="ID">st</span><span class="Operator">.</span><span class="ID">isdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 631 </span>                    <span class="ID">comp_element</span> <span class="Operator">=</span> <span class="ID">comp_pattern</span><span class="Operator">[</span><span class="ID">pos</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 632 </span>                    <span class="ResWord">if</span> <span class="ID">pos</span> <span class="Operator">+</span> <span class="Number">1</span> <span class="Operator">&lt;</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 633 </span>                        <span class="ResWord">if</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_match_element</span><span class="Operator">(</span><span class="ID">comp_element</span><span class="Operator">,</span> <span class="ID">subfilenorm</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 634 </span>                            <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">pos</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 635 </span>                            <span class="ResWord">if</span> <span class="ID">comp_pattern</span><span class="Operator">[</span><span class="ID">pos</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Operator">]</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 636 </span>                                <span class="Comment"># We should stop at '..'</span></span>
<span class="line"><span class="LineNumber"> 637 </span><span class="Comment"></span>                                <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"> 638 </span>                    <span class="ResWord">if</span> <span class="ID">comp_element</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 639 </span>                        <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 640 </span>                        <span class="Comment"># We don't have to break - there are not supposed</span></span>
<span class="line"><span class="LineNumber"> 641 </span><span class="Comment"></span>                        <span class="Comment"># to be any positions before '..'.</span></span>
<span class="line"><span class="LineNumber"> 642 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 643 </span>            <span class="ResWord">if</span> <span class="ID">newpositions</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 644 </span>                <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">reverse</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 645 </span></span>
<span class="line"><span class="LineNumber"> 646 </span>                <span class="ResWord">if</span> <span class="ID">on_path</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 647 </span>                    <span class="ID">newpath_id</span> <span class="Operator">=</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_id</span><span class="Operator">(</span><span class="ID">st</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 648 </span>                    <span class="ResWord">if</span> <span class="ID">newpath_id</span> <span class="ResWord">in</span> <span class="ID">on_path</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 649 </span>                        <span class="ResWord">raise</span> <span class="ID">OSError</span><span class="Operator">,</span> <span class="String">"Circular path encountered"</span></span>
<span class="line"><span class="LineNumber"> 650 </span>                    <span class="ID">on_path</span><span class="Operator">.</span><span class="ID">add</span><span class="Operator">(</span><span class="ID">newpath_id</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 651 </span></span>
<span class="line"><span class="LineNumber"> 652 </span>                <span class="ResWord">for</span> <span class="ID">x</span> <span class="ResWord">in</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_glob</span><span class="Operator">(</span><span class="ID">newpth</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber"> 653 </span>                                   <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber"> 654 </span>                                   <span class="ID">newpositions</span><span class="Operator">,</span> <span class="ID">on_path</span><span class="Operator">,</span> <span class="ID">stat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 655 </span>                    <span class="ResWord">yield</span> <span class="ID">x</span></span>
<span class="line"><span class="LineNumber"> 656 </span></span>
<span class="line"><span class="LineNumber"> 657 </span>                <span class="ResWord">if</span> <span class="ID">on_path</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 658 </span>                    <span class="ID">on_path</span><span class="Operator">.</span><span class="ID">remove</span><span class="Operator">(</span><span class="ID">newpath_id</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 659 </span></span>
<span class="line"><span class="LineNumber"> 660 </span>            <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">topdown</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 661 </span>                <span class="Comment"># If topdown, it happens after we handle subdirs</span></span>
<span class="line"><span class="LineNumber"> 662 </span><span class="Comment"></span>                <span class="ResWord">if</span> <span class="ID">positions</span><span class="Operator">[</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span> <span class="Operator">-</span> <span class="Number">1</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 663 </span>                    <span class="ResWord">if</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_match_element</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">[</span><span class="Operator">-</span><span class="Number">1</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">subfilenorm</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 664 </span>                        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="Operator">(</span><span class="Operator">(</span><span class="ID">onlydirs</span> <span class="ResWord">and</span> <span class="ResWord">not</span> <span class="ID">st</span><span class="Operator">.</span><span class="ID">isdir</span><span class="Operator">)</span> <span class="ResWord">or</span></span>
<span class="line"><span class="LineNumber"> 665 </span>                                <span class="Operator">(</span><span class="ID">onlyfiles</span> <span class="ResWord">and</span> <span class="ResWord">not</span> <span class="ID">st</span><span class="Operator">.</span><span class="ID">isfile</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 666 </span>                            <span class="ResWord">yield</span> <span class="ID">newpth</span></span>
<span class="line"><span class="LineNumber"> 667 </span></span>
<span class="line"><span class="LineNumber"> 668 </span>    <span class="ID">_magic_check</span> <span class="Operator">=</span> <span class="ID">re</span><span class="Operator">.</span><span class="ID">compile</span><span class="Operator">(</span><span class="String">'[*?[]'</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 669 </span></span>
<span class="line"><span class="LineNumber"> 670 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber"> 671 </span>    <span class="ResWord">def</span> <span class="ID">_has_magic</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">s</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 672 </span>        <span class="ResWord">return</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_magic_check</span><span class="Operator">.</span><span class="ID">search</span><span class="Operator">(</span><span class="ID">s</span><span class="Operator">)</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 673 </span></span>
<span class="line"><span class="LineNumber"> 674 </span>    <span class="ID">_cache</span> <span class="Operator">=</span> <span class="Operator">{</span><span class="Operator">}</span></span>
<span class="line"><span class="LineNumber"> 675 </span></span>
<span class="line"><span class="LineNumber"> 676 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber"> 677 </span>    <span class="ResWord">def</span> <span class="ID">_compile_pattern</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">pattern</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 678 </span>        <span class="Comment"># Get a pattern, return the list of compiled pattern elements</span></span>
<span class="line"><span class="LineNumber"> 679 </span><span class="Comment"></span>        <span class="Comment"># and the list of initial positions.</span></span>
<span class="line"><span class="LineNumber"> 680 </span><span class="Comment"></span>        <span class="ID">pattern</span> <span class="Operator">=</span> <span class="ID">cls</span><span class="Operator">(</span><span class="ID">pattern</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 681 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">pattern</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 682 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"pattern should be a relative path."</span></span>
<span class="line"><span class="LineNumber"> 683 </span></span>
<span class="line"><span class="LineNumber"> 684 </span>        <span class="ID">comp_pattern</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 685 </span>        <span class="ID">last_was_none</span> <span class="Operator">=</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 686 </span>        <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">pattern</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 687 </span>            <span class="ID">element</span> <span class="Operator">=</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 688 </span>            <span class="ResWord">if</span> <span class="ID">element</span> <span class="Operator">==</span> <span class="String">'**'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 689 </span>                <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">last_was_none</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 690 </span>                    <span class="ID">comp_pattern</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">None</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 691 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 692 </span>                <span class="ID">last_was_none</span> <span class="Operator">=</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 693 </span>                <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_has_magic</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 694 </span>                    <span class="ID">comp_pattern</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 695 </span>                <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 696 </span>                    <span class="ResWord">try</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 697 </span>                        <span class="ID">r</span> <span class="Operator">=</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_cache</span><span class="Operator">[</span><span class="ID">element</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 698 </span>                    <span class="ResWord">except</span> <span class="ID">KeyError</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 699 </span>                        <span class="ID">r</span> <span class="Operator">=</span> <span class="ID">re</span><span class="Operator">.</span><span class="ID">compile</span><span class="Operator">(</span><span class="ID">fnmatch</span><span class="Operator">.</span><span class="ID">translate</span><span class="Operator">(</span><span class="ID">element</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 700 </span>                        <span class="ID">cls</span><span class="Operator">.</span><span class="ID">_cache</span><span class="Operator">[</span><span class="ID">element</span><span class="Operator">]</span> <span class="Operator">=</span> <span class="ID">r</span></span>
<span class="line"><span class="LineNumber"> 701 </span>                    <span class="ID">comp_pattern</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">r</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 702 </span></span>
<span class="line"><span class="LineNumber"> 703 </span>        <span class="ResWord">if</span> <span class="ID">comp_pattern</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span> <span class="ResWord">is</span> <span class="ID">None</span> <span class="ResWord">and</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span> <span class="Operator">&gt;</span> <span class="Number">1</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 704 </span>            <span class="ID">positions</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Number">0</span><span class="Operator">,</span> <span class="Number">1</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 705 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 706 </span>            <span class="ID">positions</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 707 </span></span>
<span class="line"><span class="LineNumber"> 708 </span>        <span class="ResWord">return</span> <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">positions</span></span>
<span class="line"><span class="LineNumber"> 709 </span></span>
<span class="line"><span class="LineNumber"> 710 </span>    <span class="ResWord">def</span> <span class="ID">match</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">pattern</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 711 </span>        <span class="String">""" Return whether self matches the given pattern.</span></span>
<span class="line"><span class="LineNumber"> 712 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 713 </span><span class="String">        pattern has the same meaning as in the glob method.</span></span>
<span class="line"><span class="LineNumber"> 714 </span><span class="String">        self should be relative.</span></span>
<span class="line"><span class="LineNumber"> 715 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 716 </span><span class="String">        This method doesn't use any system calls.</span></span>
<span class="line"><span class="LineNumber"> 717 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 718 </span>        <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 719 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">"self must be a relative path"</span></span>
<span class="line"><span class="LineNumber"> 720 </span>        <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">positions</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_compile_pattern</span><span class="Operator">(</span><span class="ID">pattern</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 721 </span></span>
<span class="line"><span class="LineNumber"> 722 </span>        <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">normcase</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 723 </span>            <span class="ID">newpositions</span> <span class="Operator">=</span> <span class="Operator">[</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 724 </span>            <span class="ResWord">for</span> <span class="ID">pos</span> <span class="ResWord">in</span> <span class="ID">reversed</span><span class="Operator">(</span><span class="ID">positions</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 725 </span>                <span class="ResWord">if</span> <span class="ID">pos</span> <span class="Operator">==</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 726 </span>                    <span class="Comment"># We matched the pattern but the path isn't finished -</span></span>
<span class="line"><span class="LineNumber"> 727 </span><span class="Comment"></span>                    <span class="Comment"># too bad</span></span>
<span class="line"><span class="LineNumber"> 728 </span><span class="Comment"></span>                    <span class="ResWord">continue</span></span>
<span class="line"><span class="LineNumber"> 729 </span>                <span class="ID">comp_element</span> <span class="Operator">=</span> <span class="ID">comp_pattern</span><span class="Operator">[</span><span class="ID">pos</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber"> 730 </span>                <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_match_element</span><span class="Operator">(</span><span class="ID">comp_element</span><span class="Operator">,</span> <span class="ID">element</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 731 </span>                    <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">pos</span> <span class="Operator">+</span> <span class="Number">1</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 732 </span>                <span class="ResWord">if</span> <span class="ID">comp_element</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 733 </span>                    <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">append</span><span class="Operator">(</span><span class="ID">pos</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 734 </span>                    <span class="Comment"># No need to continue after a '**'</span></span>
<span class="line"><span class="LineNumber"> 735 </span><span class="Comment"></span>                    <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"> 736 </span>            <span class="ID">newpositions</span><span class="Operator">.</span><span class="ID">reverse</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 737 </span>            <span class="ID">positions</span> <span class="Operator">=</span> <span class="ID">newpositions</span></span>
<span class="line"><span class="LineNumber"> 738 </span>            <span class="ResWord">if</span> <span class="ResWord">not</span> <span class="ID">positions</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 739 </span>                <span class="Comment"># No point in carrying on</span></span>
<span class="line"><span class="LineNumber"> 740 </span><span class="Comment"></span>                <span class="ResWord">break</span></span>
<span class="line"><span class="LineNumber"> 741 </span></span>
<span class="line"><span class="LineNumber"> 742 </span>        <span class="ResWord">return</span> <span class="Operator">(</span><span class="ID">len</span><span class="Operator">(</span><span class="ID">comp_pattern</span><span class="Operator">)</span> <span class="ResWord">in</span> <span class="ID">positions</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 743 </span></span>
<span class="line"><span class="LineNumber"> 744 </span>    <span class="ResWord">def</span> <span class="ID">glob</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">pattern</span><span class="Operator">=</span><span class="String">'*'</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">=</span><span class="ID">True</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">=</span><span class="ID">False</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">=</span><span class="ID">False</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 745 </span>        <span class="String">""" Return an iterator over all files in self matching pattern.</span></span>
<span class="line"><span class="LineNumber"> 746 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 747 </span><span class="String">        pattern should be a relative path, which may include wildcards.</span></span>
<span class="line"><span class="LineNumber"> 748 </span><span class="String">        In addition to the regular shell wildcards, you can use '**', which</span></span>
<span class="line"><span class="LineNumber"> 749 </span><span class="String">        matches any number of directories, including 0.</span></span>
<span class="line"><span class="LineNumber"> 750 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 751 </span><span class="String">        If topdown is True (the default), a directory is yielded before its</span></span>
<span class="line"><span class="LineNumber"> 752 </span><span class="String">        descendents. If it's False, a directory is yielded after its</span></span>
<span class="line"><span class="LineNumber"> 753 </span><span class="String">        descendents.</span></span>
<span class="line"><span class="LineNumber"> 754 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 755 </span><span class="String">        If onlydirs is True, only directories will be yielded. If onlyfiles</span></span>
<span class="line"><span class="LineNumber"> 756 </span><span class="String">        is True, only regular files will be yielded.</span></span>
<span class="line"><span class="LineNumber"> 757 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 758 </span><span class="String">        This method treats symbolic links as regular files. Broken symlinks</span></span>
<span class="line"><span class="LineNumber"> 759 </span><span class="String">        won't be yielded.</span></span>
<span class="line"><span class="LineNumber"> 760 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 761 </span></span>
<span class="line"><span class="LineNumber"> 762 </span>        <span class="ResWord">if</span> <span class="ID">onlydirs</span> <span class="ResWord">and</span> <span class="ID">onlyfiles</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 763 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> \
                  <span class="String">"Only one of onlydirs and onlyfiles can be specified."</span></span>
<span class="line"><span class="LineNumber"> 764 </span></span>
<span class="line"><span class="LineNumber"> 765 </span>        <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">positions</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_compile_pattern</span><span class="Operator">(</span><span class="ID">pattern</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 766 </span></span>
<span class="line"><span class="LineNumber"> 767 </span>        <span class="ResWord">if</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_id</span> <span class="ResWord">is</span> <span class="ResWord">not</span> <span class="ID">None</span> <span class="ResWord">and</span> <span class="ID">None</span> <span class="ResWord">in</span> <span class="ID">comp_pattern</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 768 </span>            <span class="ID">on_path</span> <span class="Operator">=</span> <span class="ID">set</span><span class="Operator">(</span><span class="Operator">[</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">_id</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 769 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 770 </span>            <span class="ID">on_path</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 771 </span></span>
<span class="line"><span class="LineNumber"> 772 </span>        <span class="ResWord">for</span> <span class="ID">x</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_glob</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber"> 773 </span>                            <span class="ID">positions</span><span class="Operator">,</span> <span class="ID">on_path</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 774 </span>            <span class="ResWord">yield</span> <span class="ID">x</span></span>
<span class="line"><span class="LineNumber"> 775 </span></span>
<span class="line"><span class="LineNumber"> 776 </span>    <span class="ResWord">def</span> <span class="ID">lglob</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">pattern</span><span class="Operator">=</span><span class="String">'*'</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">=</span><span class="ID">True</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">=</span><span class="ID">False</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">=</span><span class="ID">False</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 777 </span>        <span class="String">""" Return an iterator over all files in self matching pattern.</span></span>
<span class="line"><span class="LineNumber"> 778 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 779 </span><span class="String">        pattern should be a relative path, which may include wildcards.</span></span>
<span class="line"><span class="LineNumber"> 780 </span><span class="String">        In addition to the regular shell wildcards, you can use '**', which</span></span>
<span class="line"><span class="LineNumber"> 781 </span><span class="String">        matches any number of directories, including 0.</span></span>
<span class="line"><span class="LineNumber"> 782 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 783 </span><span class="String">        If topdown is True (the default), a directory is yielded before its</span></span>
<span class="line"><span class="LineNumber"> 784 </span><span class="String">        descendents. If it's False, a directory is yielded after its</span></span>
<span class="line"><span class="LineNumber"> 785 </span><span class="String">        descendents.</span></span>
<span class="line"><span class="LineNumber"> 786 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 787 </span><span class="String">        If onlydirs is True, only directories will be yielded. If onlyfiles</span></span>
<span class="line"><span class="LineNumber"> 788 </span><span class="String">        is True, only regular files will be yielded.</span></span>
<span class="line"><span class="LineNumber"> 789 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 790 </span><span class="String">        This method treats symbolic links as special files - they won't be</span></span>
<span class="line"><span class="LineNumber"> 791 </span><span class="String">        followed, and they will be yielded even if they're broken.</span></span>
<span class="line"><span class="LineNumber"> 792 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 793 </span></span>
<span class="line"><span class="LineNumber"> 794 </span>        <span class="ResWord">if</span> <span class="ID">onlydirs</span> <span class="ResWord">and</span> <span class="ID">onlyfiles</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 795 </span>            <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> \
                  <span class="String">"Only one of onlydirs and onlyfiles can be specified."</span></span>
<span class="line"><span class="LineNumber"> 796 </span></span>
<span class="line"><span class="LineNumber"> 797 </span>        <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">positions</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_compile_pattern</span><span class="Operator">(</span><span class="ID">pattern</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 798 </span></span>
<span class="line"><span class="LineNumber"> 799 </span>        <span class="ResWord">for</span> <span class="ID">x</span> <span class="ResWord">in</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_glob</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">comp_pattern</span><span class="Operator">,</span> <span class="ID">topdown</span><span class="Operator">,</span> <span class="ID">onlydirs</span><span class="Operator">,</span> <span class="ID">onlyfiles</span><span class="Operator">,</span></span>
<span class="line"><span class="LineNumber"> 800 </span>                            <span class="ID">positions</span><span class="Operator">,</span> <span class="ID">None</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">.</span><span class="ID">lstat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 801 </span>            <span class="ResWord">yield</span> <span class="ID">x</span></span>
<span class="line"><span class="LineNumber"> 802 </span></span>
<span class="line"><span class="LineNumber"> 803 </span></span>
<span class="line"><span class="LineNumber"> 804 </span><span class="ResWord">class</span> <span class="ID">PosixPath</span><span class="Operator">(</span><span class="ID">BasePath</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 805 </span>    <span class="String">""" Represents POSIX paths. """</span></span>
<span class="line"><span class="LineNumber"> 806 </span></span>
<span class="line"><span class="LineNumber"> 807 </span>    <span class="ResWord">class</span> <span class="ID">_PosixRoot</span><span class="Operator">(</span><span class="ID">BasePath</span><span class="Operator">.</span><span class="ID">_BaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 808 </span>        <span class="String">""" Represents the filesystem root (/).</span></span>
<span class="line"><span class="LineNumber"> 809 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 810 </span><span class="String">        There's only one root on posix systems, so this is a singleton.</span></span>
<span class="line"><span class="LineNumber"> 811 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 812 </span>        <span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 813 </span>        <span class="ResWord">def</span> <span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 814 </span>            <span class="ResWord">if</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 815 </span>                <span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">object</span><span class="Operator">.</span><span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 816 </span>                <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">instance</span></span>
<span class="line"><span class="LineNumber"> 817 </span>            <span class="ResWord">return</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span></span>
<span class="line"><span class="LineNumber"> 818 </span></span>
<span class="line"><span class="LineNumber"> 819 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 820 </span>            <span class="ResWord">return</span> <span class="String">'/'</span></span>
<span class="line"><span class="LineNumber"> 821 </span></span>
<span class="line"><span class="LineNumber"> 822 </span>        <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 823 </span>            <span class="ResWord">return</span> <span class="String">'path.ROOT'</span></span>
<span class="line"><span class="LineNumber"> 824 </span></span>
<span class="line"><span class="LineNumber"> 825 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber"> 826 </span></span>
<span class="line"><span class="LineNumber"> 827 </span>    <span class="ID">_OSBaseRoot</span> <span class="Operator">=</span> <span class="ID">_PosixRoot</span></span>
<span class="line"><span class="LineNumber"> 828 </span></span>
<span class="line"><span class="LineNumber"> 829 </span>    <span class="ID">ROOT</span> <span class="Operator">=</span> <span class="ID">_PosixRoot</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 830 </span></span>
<span class="line"><span class="LineNumber"> 831 </span>    <span class="Comment"># Public constants</span></span>
<span class="line"><span class="LineNumber"> 832 </span><span class="Comment"></span>    <span class="ID">curdir</span> <span class="Operator">=</span> <span class="String">'.'</span></span>
<span class="line"><span class="LineNumber"> 833 </span>    <span class="ID">pardir</span> <span class="Operator">=</span> <span class="String">'..'</span></span>
<span class="line"><span class="LineNumber"> 834 </span></span>
<span class="line"><span class="LineNumber"> 835 </span>    <span class="Comment"># Private constants</span></span>
<span class="line"><span class="LineNumber"> 836 </span><span class="Comment"></span>    <span class="ID">_sep</span> <span class="Operator">=</span> <span class="String">'/'</span></span>
<span class="line"><span class="LineNumber"> 837 </span>    <span class="ID">_altsep</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 838 </span></span>
<span class="line"><span class="LineNumber"> 839 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber"> 840 </span>    <span class="ResWord">def</span> <span class="ID">_parse_str</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">pathstr</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 841 </span>        <span class="Comment"># get a path string and return an iterable over path elements.</span></span>
<span class="line"><span class="LineNumber"> 842 </span><span class="Comment"></span>        <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 843 </span>            <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'//'</span><span class="Operator">)</span> <span class="ResWord">and</span> <span class="ResWord">not</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'///'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 844 </span>                <span class="Comment"># Two initial slashes have application-specific meaning</span></span>
<span class="line"><span class="LineNumber"> 845 </span><span class="Comment"></span>                <span class="Comment"># in POSIX, and it's not supported currently.</span></span>
<span class="line"><span class="LineNumber"> 846 </span><span class="Comment"></span>                <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> \
                      <span class="String">"Paths with two leading slashes aren't supported."</span></span>
<span class="line"><span class="LineNumber"> 847 </span>            <span class="ResWord">yield</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">ROOT</span></span>
<span class="line"><span class="LineNumber"> 848 </span>        <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">split</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 849 </span>            <span class="ResWord">if</span> <span class="ID">element</span> <span class="Operator">==</span> <span class="String">''</span> <span class="ResWord">or</span> <span class="ID">element</span> <span class="Operator">==</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">curdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 850 </span>                <span class="ResWord">continue</span></span>
<span class="line"><span class="LineNumber"> 851 </span>            <span class="Comment"># '..' aren't specially treated, since popping the last</span></span>
<span class="line"><span class="LineNumber"> 852 </span><span class="Comment"></span>            <span class="Comment"># element isn't correct if the last element was a symbolic</span></span>
<span class="line"><span class="LineNumber"> 853 </span><span class="Comment"></span>            <span class="Comment"># link.</span></span>
<span class="line"><span class="LineNumber"> 854 </span><span class="Comment"></span>            <span class="ResWord">yield</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber"> 855 </span></span>
<span class="line"><span class="LineNumber"> 856 </span></span>
<span class="line"><span class="LineNumber"> 857 </span>    <span class="Comment"># POSIX-specific methods</span></span>
<span class="line"><span class="LineNumber"> 858 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 859 </span></span>
<span class="line"><span class="LineNumber"> 860 </span>    <span class="Comment"># --- Info about the path</span></span>
<span class="line"><span class="LineNumber"> 861 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 862 </span>    <span class="ResWord">def</span> <span class="ID">statvfs</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 863 </span>        <span class="String">""" Perform a statvfs() system call on this path. """</span></span>
<span class="line"><span class="LineNumber"> 864 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">statvfs</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 865 </span></span>
<span class="line"><span class="LineNumber"> 866 </span>    <span class="ResWord">def</span> <span class="ID">pathconf</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">name</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 867 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">pathconf</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">name</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 868 </span></span>
<span class="line"><span class="LineNumber"> 869 </span>    <span class="ResWord">def</span> <span class="ID">samefile</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">other</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 870 </span>        <span class="ID">other</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">other</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 871 </span>        <span class="ID">s1</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 872 </span>        <span class="ID">s2</span> <span class="Operator">=</span> <span class="ID">other</span><span class="Operator">.</span><span class="ID">stat</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 873 </span>        <span class="ResWord">return</span> <span class="ID">s1</span><span class="Operator">.</span><span class="ID">st_ino</span> <span class="Operator">==</span> <span class="ID">s2</span><span class="Operator">.</span><span class="ID">st_ino</span> <span class="ResWord">and</span> \
               <span class="ID">s1</span><span class="Operator">.</span><span class="ID">st_dev</span> <span class="Operator">==</span> <span class="ID">s2</span><span class="Operator">.</span><span class="ID">st_dev</span></span>
<span class="line"><span class="LineNumber"> 874 </span></span>
<span class="line"><span class="LineNumber"> 875 </span></span>
<span class="line"><span class="LineNumber"> 876 </span>    <span class="Comment"># --- Modifying operations on files and directories</span></span>
<span class="line"><span class="LineNumber"> 877 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 878 </span>    <span class="ResWord">def</span> <span class="ID">chown</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">uid</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">gid</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 879 </span>        <span class="ResWord">if</span> <span class="ID">uid</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 880 </span>            <span class="ID">uid</span> <span class="Operator">=</span> <span class="Operator">-</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 881 </span>        <span class="ResWord">if</span> <span class="ID">gid</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 882 </span>            <span class="ID">gid</span> <span class="Operator">=</span> <span class="Operator">-</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 883 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">chown</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">uid</span><span class="Operator">,</span> <span class="ID">gid</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 884 </span></span>
<span class="line"><span class="LineNumber"> 885 </span>    <span class="ResWord">def</span> <span class="ID">lchown</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">uid</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">,</span> <span class="ID">gid</span><span class="Operator">=</span><span class="ID">None</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 886 </span>        <span class="ResWord">if</span> <span class="ID">uid</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 887 </span>            <span class="ID">uid</span> <span class="Operator">=</span> <span class="Operator">-</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 888 </span>        <span class="ResWord">if</span> <span class="ID">gid</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 889 </span>            <span class="ID">gid</span> <span class="Operator">=</span> <span class="Operator">-</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber"> 890 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">lchown</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">uid</span><span class="Operator">,</span> <span class="ID">gid</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 891 </span></span>
<span class="line"><span class="LineNumber"> 892 </span></span>
<span class="line"><span class="LineNumber"> 893 </span>    <span class="Comment"># --- Links</span></span>
<span class="line"><span class="LineNumber"> 894 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 895 </span>    <span class="ResWord">def</span> <span class="ID">link</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">newpath</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 896 </span>        <span class="String">""" Create a hard link at 'newpath', pointing to this file. """</span></span>
<span class="line"><span class="LineNumber"> 897 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">link</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">newpath</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 898 </span></span>
<span class="line"><span class="LineNumber"> 899 </span>    <span class="ResWord">def</span> <span class="ID">writelink</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">src</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 900 </span>        <span class="String">""" Create a symbolic link at self, pointing to src.</span></span>
<span class="line"><span class="LineNumber"> 901 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 902 </span><span class="String">        src may be any string. Note that if it's a relative path, it</span></span>
<span class="line"><span class="LineNumber"> 903 </span><span class="String">        will be interpreted relative to self, not relative to the current</span></span>
<span class="line"><span class="LineNumber"> 904 </span><span class="String">        working directory.</span></span>
<span class="line"><span class="LineNumber"> 905 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 906 </span>        <span class="ID">os</span><span class="Operator">.</span><span class="ID">symlink</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">src</span><span class="Operator">)</span><span class="Operator">,</span> <span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 907 </span></span>
<span class="line"><span class="LineNumber"> 908 </span>    <span class="ResWord">def</span> <span class="ID">readlink</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 909 </span>        <span class="String">""" Return the path to which this symbolic link points.</span></span>
<span class="line"><span class="LineNumber"> 910 </span><span class="String"></span></span>
<span class="line"><span class="LineNumber"> 911 </span><span class="String">        The result is a string, which may be an absolute path, a</span></span>
<span class="line"><span class="LineNumber"> 912 </span><span class="String">        relative path (which should be interpreted relative to self[:-1]),</span></span>
<span class="line"><span class="LineNumber"> 913 </span><span class="String">        or any arbitrary string.</span></span>
<span class="line"><span class="LineNumber"> 914 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 915 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">readlink</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 916 </span></span>
<span class="line"><span class="LineNumber"> 917 </span>    <span class="ResWord">def</span> <span class="ID">readlinkpath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 918 </span>        <span class="String">""" Return the path to which this symbolic link points. """</span></span>
<span class="line"><span class="LineNumber"> 919 </span>        <span class="ID">linkpath</span> <span class="Operator">=</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">__class__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">readlink</span><span class="Operator">(</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 920 </span>        <span class="ResWord">if</span> <span class="ID">linkpath</span><span class="Operator">.</span><span class="ID">isrel</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 921 </span>            <span class="ResWord">return</span> <span class="ID">self</span> <span class="Operator">+</span> <span class="ID">linkpath</span></span>
<span class="line"><span class="LineNumber"> 922 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 923 </span>            <span class="ResWord">return</span> <span class="ID">linkpath</span></span>
<span class="line"><span class="LineNumber"> 924 </span></span>
<span class="line"><span class="LineNumber"> 925 </span></span>
<span class="line"><span class="LineNumber"> 926 </span>    <span class="Comment"># --- Extra</span></span>
<span class="line"><span class="LineNumber"> 927 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 928 </span>    <span class="ResWord">def</span> <span class="ID">mkfifo</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 929 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">mkfifo</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 930 </span></span>
<span class="line"><span class="LineNumber"> 931 </span>    <span class="ResWord">def</span> <span class="ID">mknod</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 932 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">mknod</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">,</span> <span class="Operator">*</span><span class="ID">args</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 933 </span></span>
<span class="line"><span class="LineNumber"> 934 </span>    <span class="ResWord">def</span> <span class="ID">chroot</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 935 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">chroot</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 936 </span></span>
<span class="line"><span class="LineNumber"> 937 </span></span>
<span class="line"><span class="LineNumber"> 938 </span>    <span class="Comment"># --- Globbing</span></span>
<span class="line"><span class="LineNumber"> 939 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber"> 940 </span>    <span class="Error">@</span><span class="ID">staticmethod</span></span>
<span class="line"><span class="LineNumber"> 941 </span>    <span class="ResWord">def</span> <span class="ID">_id</span><span class="Operator">(</span><span class="ID">stat</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 942 </span>        <span class="ResWord">return</span> <span class="Operator">(</span><span class="ID">stat</span><span class="Operator">.</span><span class="ID">st_ino</span><span class="Operator">,</span> <span class="ID">stat</span><span class="Operator">.</span><span class="ID">st_dev</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 943 </span></span>
<span class="line"><span class="LineNumber"> 944 </span></span>
<span class="line"><span class="LineNumber"> 945 </span><span class="ResWord">class</span> <span class="ID">NTPath</span><span class="Operator">(</span><span class="ID">BasePath</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 946 </span>    <span class="String">""" Represents paths on Windows operating systems. """</span></span>
<span class="line"><span class="LineNumber"> 947 </span></span>
<span class="line"><span class="LineNumber"> 948 </span>    <span class="ResWord">class</span> <span class="ID">_NTBaseRoot</span><span class="Operator">(</span><span class="ID">BasePath</span><span class="Operator">.</span><span class="ID">_BaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 949 </span>        <span class="String">""" The base class of all Windows root classes. """</span></span>
<span class="line"><span class="LineNumber"> 950 </span>        <span class="ResWord">pass</span></span>
<span class="line"><span class="LineNumber"> 951 </span></span>
<span class="line"><span class="LineNumber"> 952 </span>    <span class="ID">_OSBaseRoot</span> <span class="Operator">=</span> <span class="ID">_NTBaseRoot</span></span>
<span class="line"><span class="LineNumber"> 953 </span></span>
<span class="line"><span class="LineNumber"> 954 </span>    <span class="ResWord">class</span> <span class="ID">_CurRootType</span><span class="Operator">(</span><span class="ID">_NTBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 955 </span>        <span class="String">""" Represents the root of the current working drive.</span></span>
<span class="line"><span class="LineNumber"> 956 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber"> 957 </span><span class="String">        This class is a singleton. It represents the root of the current</span></span>
<span class="line"><span class="LineNumber"> 958 </span><span class="String">        working drive - paths starting with '\'.</span></span>
<span class="line"><span class="LineNumber"> 959 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber"> 960 </span>        <span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">None</span></span>
<span class="line"><span class="LineNumber"> 961 </span>        <span class="ResWord">def</span> <span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 962 </span>            <span class="ResWord">if</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span> <span class="ResWord">is</span> <span class="ID">None</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 963 </span>                <span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">object</span><span class="Operator">.</span><span class="ID">__new__</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 964 </span>                <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span> <span class="Operator">=</span> <span class="ID">instance</span></span>
<span class="line"><span class="LineNumber"> 965 </span>            <span class="ResWord">return</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">instance</span></span>
<span class="line"><span class="LineNumber"> 966 </span></span>
<span class="line"><span class="LineNumber"> 967 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 968 </span>            <span class="ResWord">return</span> <span class="String">'\\'</span></span>
<span class="line"><span class="LineNumber"> 969 </span></span>
<span class="line"><span class="LineNumber"> 970 </span>        <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 971 </span>            <span class="ResWord">return</span> <span class="String">'path.CURROOT'</span></span>
<span class="line"><span class="LineNumber"> 972 </span></span>
<span class="line"><span class="LineNumber"> 973 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber"> 974 </span></span>
<span class="line"><span class="LineNumber"> 975 </span>        <span class="ResWord">def</span> <span class="ID">abspath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 976 </span>            <span class="ResWord">from</span> <span class="ID">nt</span> <span class="ResWord">import</span> <span class="ID">_getfullpathname</span></span>
<span class="line"><span class="LineNumber"> 977 </span>            <span class="ResWord">return</span> <span class="ID">NTPath</span><span class="Operator">(</span><span class="ID">_getfullpathname</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 978 </span></span>
<span class="line"><span class="LineNumber"> 979 </span>    <span class="ID">CURROOT</span> <span class="Operator">=</span> <span class="ID">_CurRootType</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 980 </span></span>
<span class="line"><span class="LineNumber"> 981 </span>    <span class="ResWord">class</span> <span class="ID">Drive</span><span class="Operator">(</span><span class="ID">_NTBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 982 </span>        <span class="String">""" Represents the root of a specific drive. """</span></span>
<span class="line"><span class="LineNumber"> 983 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">letter</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 984 </span>            <span class="Comment"># Drive letter is normalized - we don't lose any information</span></span>
<span class="line"><span class="LineNumber"> 985 </span><span class="Comment"></span>            <span class="ResWord">if</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">letter</span><span class="Operator">)</span> <span class="Operator">!=</span> <span class="Number">1</span> <span class="ResWord">or</span> <span class="ID">letter</span> <span class="ResWord">not</span> <span class="ResWord">in</span> <span class="ID">string</span><span class="Operator">.</span><span class="ID">letters</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 986 </span>                <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">'Should get one letter'</span></span>
<span class="line"><span class="LineNumber"> 987 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">_letter</span> <span class="Operator">=</span> <span class="ID">letter</span><span class="Operator">.</span><span class="ID">lower</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber"> 988 </span></span>
<span class="line"><span class="LineNumber"> 989 </span>        <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber"> 990 </span>        <span class="ResWord">def</span> <span class="ID">letter</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 991 </span>            <span class="Comment"># We use a property because we want the object to be immutable.</span></span>
<span class="line"><span class="LineNumber"> 992 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_letter</span></span>
<span class="line"><span class="LineNumber"> 993 </span></span>
<span class="line"><span class="LineNumber"> 994 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 995 </span>            <span class="ResWord">return</span> <span class="String">'%s:\\'</span> <span class="Operator">%</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">letter</span></span>
<span class="line"><span class="LineNumber"> 996 </span></span>
<span class="line"><span class="LineNumber"> 997 </span>        <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber"> 998 </span>            <span class="ResWord">return</span> <span class="String">'path.Drive(%r)'</span> <span class="Operator">%</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">letter</span></span>
<span class="line"><span class="LineNumber"> 999 </span></span>
<span class="line"><span class="LineNumber">1000 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber">1001 </span></span>
<span class="line"><span class="LineNumber">1002 </span>    <span class="ResWord">class</span> <span class="ID">UnrootedDrive</span><span class="Operator">(</span><span class="ID">_NTBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1003 </span>        <span class="String">""" Represents the current working directory on a specific drive. """</span></span>
<span class="line"><span class="LineNumber">1004 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">letter</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1005 </span>            <span class="Comment"># Drive letter is normalized - we don't lose any information</span></span>
<span class="line"><span class="LineNumber">1006 </span><span class="Comment"></span>            <span class="ResWord">if</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">letter</span><span class="Operator">)</span> <span class="Operator">!=</span> <span class="Number">1</span> <span class="ResWord">or</span> <span class="ID">letter</span> <span class="ResWord">not</span> <span class="ResWord">in</span> <span class="ID">string</span><span class="Operator">.</span><span class="ID">letters</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1007 </span>                <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> <span class="String">'Should get one letter'</span></span>
<span class="line"><span class="LineNumber">1008 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">_letter</span> <span class="Operator">=</span> <span class="ID">letter</span><span class="Operator">.</span><span class="ID">lower</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1009 </span></span>
<span class="line"><span class="LineNumber">1010 </span>        <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">1011 </span>        <span class="ResWord">def</span> <span class="ID">letter</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1012 </span>            <span class="Comment"># We use a property because we want the object to be immutable.</span></span>
<span class="line"><span class="LineNumber">1013 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_letter</span></span>
<span class="line"><span class="LineNumber">1014 </span></span>
<span class="line"><span class="LineNumber">1015 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1016 </span>            <span class="ResWord">return</span> <span class="String">'%s:'</span> <span class="Operator">%</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">letter</span></span>
<span class="line"><span class="LineNumber">1017 </span></span>
<span class="line"><span class="LineNumber">1018 </span>        <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1019 </span>            <span class="ResWord">return</span> <span class="String">'path.UnrootedDrive(%r)'</span> <span class="Operator">%</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">letter</span></span>
<span class="line"><span class="LineNumber">1020 </span></span>
<span class="line"><span class="LineNumber">1021 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">False</span></span>
<span class="line"><span class="LineNumber">1022 </span></span>
<span class="line"><span class="LineNumber">1023 </span>        <span class="ResWord">def</span> <span class="ID">abspath</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1024 </span>            <span class="ResWord">from</span> <span class="ID">nt</span> <span class="ResWord">import</span> <span class="ID">_getfullpathname</span></span>
<span class="line"><span class="LineNumber">1025 </span>            <span class="ResWord">return</span> <span class="ID">NTPath</span><span class="Operator">(</span><span class="ID">_getfullpathname</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1026 </span></span>
<span class="line"><span class="LineNumber">1027 </span>    <span class="ResWord">class</span> <span class="ID">UNCRoot</span><span class="Operator">(</span><span class="ID">_NTBaseRoot</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1028 </span>        <span class="String">""" Represents a UNC mount point. """</span></span>
<span class="line"><span class="LineNumber">1029 </span>        <span class="ResWord">def</span> <span class="ID">__init__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">,</span> <span class="ID">host</span><span class="Operator">,</span> <span class="ID">mountpoint</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1030 </span>            <span class="Comment"># Host and mountpoint are normalized - we don't lose any information</span></span>
<span class="line"><span class="LineNumber">1031 </span><span class="Comment"></span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">_host</span> <span class="Operator">=</span> <span class="ID">host</span><span class="Operator">.</span><span class="ID">lower</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1032 </span>            <span class="ID">self</span><span class="Operator">.</span><span class="ID">_mountpoint</span> <span class="Operator">=</span> <span class="ID">mountpoint</span><span class="Operator">.</span><span class="ID">lower</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1033 </span></span>
<span class="line"><span class="LineNumber">1034 </span>        <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">1035 </span>        <span class="ResWord">def</span> <span class="ID">host</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1036 </span>            <span class="Comment"># We use a property because we want the object to be immutable.</span></span>
<span class="line"><span class="LineNumber">1037 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_host</span></span>
<span class="line"><span class="LineNumber">1038 </span></span>
<span class="line"><span class="LineNumber">1039 </span>        <span class="Error">@</span><span class="ID">property</span></span>
<span class="line"><span class="LineNumber">1040 </span>        <span class="ResWord">def</span> <span class="ID">mountpoint</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1041 </span>            <span class="Comment"># We use a property because we want the object to be immutable.</span></span>
<span class="line"><span class="LineNumber">1042 </span><span class="Comment"></span>            <span class="ResWord">return</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">_mountpoint</span></span>
<span class="line"><span class="LineNumber">1043 </span></span>
<span class="line"><span class="LineNumber">1044 </span>        <span class="ResWord">def</span> <span class="ID">__str__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1045 </span>            <span class="ResWord">return</span> <span class="String">'\\\\%s\\%s\\'</span> <span class="Operator">%</span> <span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">host</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">mountpoint</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1046 </span></span>
<span class="line"><span class="LineNumber">1047 </span>        <span class="ResWord">def</span> <span class="ID">__repr__</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1048 </span>            <span class="ResWord">return</span> <span class="String">'path.UNCRoot(%r, %r)'</span> <span class="Operator">%</span> <span class="Operator">(</span><span class="ID">self</span><span class="Operator">.</span><span class="ID">host</span><span class="Operator">,</span> <span class="ID">self</span><span class="Operator">.</span><span class="ID">mountpoint</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1049 </span></span>
<span class="line"><span class="LineNumber">1050 </span>        <span class="ID">isabs</span> <span class="Operator">=</span> <span class="ID">True</span></span>
<span class="line"><span class="LineNumber">1051 </span></span>
<span class="line"><span class="LineNumber">1052 </span></span>
<span class="line"><span class="LineNumber">1053 </span>    <span class="Comment"># Public constants</span></span>
<span class="line"><span class="LineNumber">1054 </span><span class="Comment"></span>    <span class="ID">curdir</span> <span class="Operator">=</span> <span class="String">'.'</span></span>
<span class="line"><span class="LineNumber">1055 </span>    <span class="ID">pardir</span> <span class="Operator">=</span> <span class="String">'..'</span></span>
<span class="line"><span class="LineNumber">1056 </span></span>
<span class="line"><span class="LineNumber">1057 </span>    <span class="Comment"># Private constants</span></span>
<span class="line"><span class="LineNumber">1058 </span><span class="Comment"></span>    <span class="ID">_sep</span> <span class="Operator">=</span> <span class="String">'\\'</span></span>
<span class="line"><span class="LineNumber">1059 </span>    <span class="ID">_altsep</span> <span class="Operator">=</span> <span class="String">'/'</span></span>
<span class="line"><span class="LineNumber">1060 </span></span>
<span class="line"><span class="LineNumber">1061 </span>    <span class="Error">@</span><span class="ID">staticmethod</span></span>
<span class="line"><span class="LineNumber">1062 </span>    <span class="ResWord">def</span> <span class="ID">normcasestr</span><span class="Operator">(</span><span class="ID">string</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1063 </span>        <span class="String">""" Normalize the case of one path element.</span></span>
<span class="line"><span class="LineNumber">1064 </span><span class="String">        </span></span>
<span class="line"><span class="LineNumber">1065 </span><span class="String">        On Windows, this returns string.lower()</span></span>
<span class="line"><span class="LineNumber">1066 </span><span class="String">        """</span></span>
<span class="line"><span class="LineNumber">1067 </span>        <span class="ResWord">return</span> <span class="ID">string</span><span class="Operator">.</span><span class="ID">lower</span><span class="Operator">(</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1068 </span></span>
<span class="line"><span class="LineNumber">1069 </span>    <span class="Error">@</span><span class="ID">classmethod</span></span>
<span class="line"><span class="LineNumber">1070 </span>    <span class="ResWord">def</span> <span class="ID">_parse_str</span><span class="Operator">(</span><span class="ID">cls</span><span class="Operator">,</span> <span class="ID">pathstr</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1071 </span>        <span class="Comment"># get a path string and return an iterable over path elements.</span></span>
<span class="line"><span class="LineNumber">1072 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1073 </span>        <span class="Comment"># First, replace all backslashes with slashes.</span></span>
<span class="line"><span class="LineNumber">1074 </span><span class="Comment"></span>        <span class="Comment"># I know that it should have been the other way round, but I can't</span></span>
<span class="line"><span class="LineNumber">1075 </span><span class="Comment"></span>        <span class="Comment"># stand all those escapes.</span></span>
<span class="line"><span class="LineNumber">1076 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1077 </span>        <span class="ID">pathstr</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">replace</span><span class="Operator">(</span><span class="String">'\\'</span><span class="Operator">,</span> <span class="String">'/'</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1078 </span></span>
<span class="line"><span class="LineNumber">1079 </span>        <span class="Comment"># Handle the root element</span></span>
<span class="line"><span class="LineNumber">1080 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1081 </span>        <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1082 </span>            <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'//'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1083 </span>                <span class="Comment"># UNC Path</span></span>
<span class="line"><span class="LineNumber">1084 </span><span class="Comment"></span>                <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">startswith</span><span class="Operator">(</span><span class="String">'///'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1085 </span>                    <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> \
                          <span class="String">"Paths can't start with more than two slashes"</span></span>
<span class="line"><span class="LineNumber">1086 </span>                <span class="ID">index</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">find</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">,</span> <span class="Number">2</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1087 </span>                <span class="ResWord">if</span> <span class="ID">index</span> <span class="Operator">==</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1088 </span>                    <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> \
                          <span class="String">"UNC host name should end with a slash"</span></span>
<span class="line"><span class="LineNumber">1089 </span>                <span class="ID">index2</span> <span class="Operator">=</span> <span class="ID">index</span><span class="Operator">+</span><span class="Number">1</span></span>
<span class="line"><span class="LineNumber">1090 </span>                <span class="ResWord">while</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="ID">index2</span><span class="Operator">:</span><span class="ID">index2</span><span class="Operator">+</span><span class="Number">1</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="String">'/'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1091 </span>                    <span class="ID">index2</span> <span class="Operator">+=</span> <span class="Number">1</span></span>
<span class="line"><span class="LineNumber">1092 </span>                <span class="ResWord">if</span> <span class="ID">index2</span> <span class="Operator">==</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1093 </span>                    <span class="ResWord">raise</span> <span class="ID">ValueError</span><span class="Operator">,</span> \
                          <span class="String">"UNC mount point is empty"</span></span>
<span class="line"><span class="LineNumber">1094 </span>                <span class="ID">index3</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">find</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">,</span> <span class="ID">index2</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1095 </span>                <span class="ResWord">if</span> <span class="ID">index3</span> <span class="Operator">==</span> <span class="Operator">-</span><span class="Number">1</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1096 </span>                    <span class="ID">index3</span> <span class="Operator">=</span> <span class="ID">len</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1097 </span>                <span class="ResWord">yield</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">UNCRoot</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">2</span><span class="Operator">:</span><span class="ID">index</span><span class="Operator">]</span><span class="Operator">,</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="ID">index2</span><span class="Operator">:</span><span class="ID">index3</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1098 </span>                <span class="ID">pathstr</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="ID">index3</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">1099 </span>            <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1100 </span>                <span class="Comment"># CURROOT</span></span>
<span class="line"><span class="LineNumber">1101 </span><span class="Comment"></span>                <span class="ResWord">yield</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">CURROOT</span></span>
<span class="line"><span class="LineNumber">1102 </span>        <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1103 </span>            <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">1</span><span class="Operator">:</span><span class="Number">2</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="String">':'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1104 </span>                <span class="ResWord">if</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">2</span><span class="Operator">:</span><span class="Number">3</span><span class="Operator">]</span> <span class="Operator">==</span> <span class="String">'/'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1105 </span>                    <span class="Comment"># Rooted drive</span></span>
<span class="line"><span class="LineNumber">1106 </span><span class="Comment"></span>                    <span class="ResWord">yield</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">Drive</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1107 </span>                    <span class="ID">pathstr</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">3</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">1108 </span>                <span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1109 </span>                    <span class="Comment"># Unrooted drive</span></span>
<span class="line"><span class="LineNumber">1110 </span><span class="Comment"></span>                    <span class="ResWord">yield</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">UnrootedDrive</span><span class="Operator">(</span><span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">0</span><span class="Operator">]</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1111 </span>                    <span class="ID">pathstr</span> <span class="Operator">=</span> <span class="ID">pathstr</span><span class="Operator">[</span><span class="Number">2</span><span class="Operator">:</span><span class="Operator">]</span></span>
<span class="line"><span class="LineNumber">1112 </span></span>
<span class="line"><span class="LineNumber">1113 </span>        <span class="Comment"># Handle all other elements</span></span>
<span class="line"><span class="LineNumber">1114 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1115 </span>        <span class="ResWord">for</span> <span class="ID">element</span> <span class="ResWord">in</span> <span class="ID">pathstr</span><span class="Operator">.</span><span class="ID">split</span><span class="Operator">(</span><span class="String">'/'</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1116 </span>            <span class="ResWord">if</span> <span class="ID">element</span> <span class="Operator">==</span> <span class="String">''</span> <span class="ResWord">or</span> <span class="ID">element</span> <span class="Operator">==</span> <span class="ID">cls</span><span class="Operator">.</span><span class="ID">curdir</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1117 </span>                <span class="ResWord">continue</span></span>
<span class="line"><span class="LineNumber">1118 </span>            <span class="Comment"># We don't treat pardir specially, since in the presence of</span></span>
<span class="line"><span class="LineNumber">1119 </span><span class="Comment"></span>            <span class="Comment"># links there's nothing to do about them.</span></span>
<span class="line"><span class="LineNumber">1120 </span><span class="Comment"></span>            <span class="Comment"># Windows doesn't have links, but why not keep path handling</span></span>
<span class="line"><span class="LineNumber">1121 </span><span class="Comment"></span>            <span class="Comment"># similiar?</span></span>
<span class="line"><span class="LineNumber">1122 </span><span class="Comment"></span>            <span class="ResWord">yield</span> <span class="ID">element</span></span>
<span class="line"><span class="LineNumber">1123 </span></span>
<span class="line"><span class="LineNumber">1124 </span></span>
<span class="line"><span class="LineNumber">1125 </span>    <span class="Comment"># NT-specific methods</span></span>
<span class="line"><span class="LineNumber">1126 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1127 </span>    <span class="Comment"># --- Extra</span></span>
<span class="line"><span class="LineNumber">1128 </span><span class="Comment"></span></span>
<span class="line"><span class="LineNumber">1129 </span>    <span class="ResWord">def</span> <span class="ID">startfile</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1130 </span>        <span class="ResWord">return</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">startfile</span><span class="Operator">(</span><span class="ID">str</span><span class="Operator">(</span><span class="ID">self</span><span class="Operator">)</span><span class="Operator">)</span></span>
<span class="line"><span class="LineNumber">1131 </span></span>
<span class="line"><span class="LineNumber">1132 </span><span class="ResWord">if</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">name</span> <span class="Operator">==</span> <span class="String">'posix'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1133 </span>    <span class="ID">path</span> <span class="Operator">=</span> <span class="ID">PosixPath</span></span>
<span class="line"><span class="LineNumber">1134 </span><span class="ResWord">elif</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">name</span> <span class="Operator">==</span> <span class="String">'nt'</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1135 </span>    <span class="ID">path</span> <span class="Operator">=</span> <span class="ID">NTPath</span></span>
<span class="line"><span class="LineNumber">1136 </span><span class="ResWord">else</span><span class="Operator">:</span></span>
<span class="line"><span class="LineNumber">1137 </span>    <span class="ResWord">raise</span> <span class="ID">NotImplementedError</span><span class="Operator">,</span> \
          <span class="String">"The path object is currently not implemented for OS %r"</span> <span class="Operator">%</span> <span class="ID">os</span><span class="Operator">.</span><span class="ID">name</span><span class="Text"></span></span>
</pre>
</div>
<a id="bottom"></a>

</div>

<p><a href="/moin/AlternativePathModule?action=edit">EditText</a> (last edited 2006-05-02 14:01:48 by <span title="proxy7-m.huji.ac.il">NoamRaphael</span>)</p>

<!-- END: Document Content -->
    </div>
  </div>


  <!-- Left Hand Navigation Block -->
  <div id="left-hand-navigation">
    <!-- Main Menu -->
    <div id="menu">
      <ul class="level-one">
        <li><a href="/moin/UserPreferences">Login</a></li>
	<li> Navigation
          <ul class="level-two">
	    <li> <a href="/moin/FrontPage">Front Page</a></li>
	    <li> <a href="/moin/TitleIndex">Title Index</a></li>
	    <li> <a href="/moin/RecentChanges">Recent Changes</a></li>
	    <li> <a href="/moin/FindPage">Find Page</a></li>
	    <li> <a href="/moin/HelpContents">Help</a></li>
	    <li> <a href="/moin/SiteNavigation">Site Navigation</a></li>
          </ul>
        <li> Actions
          <ul class="level-two">
	    <li><a href="/moin/AlternativePathModule?action=AttachFile">Attachments</a></li><li><a href="/moin/AlternativePathModule?action=LikePages">Like Pages</a></li><li><a href="/moin/AlternativePathModule?action=LocalSiteMap">Local Site Map</a></li><li><a href="/moin/AlternativePathModule?action=SpellCheck">Spell Check</a></li>
          </ul>
        </li>
	<li> Your recent pages
	  <ul class="level-two">
	    
          </ul></li>
      </ul>
    </div>
  </div>
<!-- end of page -->
</body>
</html>	
</body>
</html>

